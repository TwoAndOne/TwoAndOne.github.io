<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.jpeg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.jpeg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.jpeg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"twoandone.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.12.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="后端废物">
<meta property="og:type" content="website">
<meta property="og:title" content="Yussss">
<meta property="og:url" content="https://twoandone.github.io/page/3/">
<meta property="og:site_name" content="Yussss">
<meta property="og:description" content="后端废物">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Yus">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://twoandone.github.io/page/3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/3/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Yussss</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Yussss</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">沧浪之水清兮，可以濯我缨。沧浪之水浊兮，可以濯我足</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Yus"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">Yus</p>
  <div class="site-description" itemprop="description">后端废物</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">54</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="mailto:2414655851@qq.com" title="E-Mail → mailto:2414655851@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://twoandone.github.io/2021/03/21/%E7%90%86%E8%A7%A3BIO-NIO-AIO-IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Yus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yussss">
      <meta itemprop="description" content="后端废物">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Yussss">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/21/%E7%90%86%E8%A7%A3BIO-NIO-AIO-IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/" class="post-title-link" itemprop="url">理解BIO,NIO,AIO,IO多路复用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-21 18:56:41" itemprop="dateCreated datePublished" datetime="2021-03-21T18:56:41+08:00">2021-03-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-18 01:04:09" itemprop="dateModified" datetime="2022-07-18T01:04:09+08:00">2022-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>预备知识:</strong></p>
<p>操作系统分内核态与用户态,真正的I/O操作都不是应用程序在做,为了保证安全,操作系统提供了系统调用,比如read&amp;write.</p>
<p>通常一个应用程序的执行代表一个进程,当应用程序需要I/O时就会执行系统调用.</p>
<p>比如一次read指令的执行,应用调用read指令,内核从外部设备获取数据放入内核缓冲区,然后又把内核缓存区的内容复制到进程缓冲区.</p>
<p><strong>四种IO模型:</strong></p>
<p>１.　BＩＯ，同步阻塞IO</p>
<p>２.　ＮＩＯ，同步非阻塞IO</p>
<p>３.　IO多路复用,同步非阻塞IO升级版</p>
<p>４.　AIO，异步非阻塞IO</p>
<p>怎么理解用一个例子来执行一下就好啦</p>
<p><strong>BIO</strong></p>
<p><img src="https://github.com/TwoAndOne/my-images/raw/master/img/image-20210321191140634.png" alt="image-20210321191140634" style="zoom:67%;" /></p>
<p>首先我们得知道,内核态的内存缓冲区也不是一开始就有数据的,所以这就分了两个阶段,</p>
<p>第一个是等待内核态内存缓存区充满的过程,</p>
<p>第二个是从内核态内存缓存区复制到进程缓冲区的过程</p>
<p>所以同步阻塞IO就比较惨,在这两个阶段都得等着</p>
<p>第一个阶段是阻塞,用户态发起IO执行read调用指令,如果内核态没数据就被ＯＳ挂起</p>
<p>第二个阶段内核态复制数据到进程缓冲区,它也不能干其他的.</p>
<p><strong>NIO</strong></p>
<p><img src="https://github.com/TwoAndOne/my-images/raw/master/img/image-20210321191002045.png" alt="image-20210321191002045" style="zoom:70%;" /></p>
<p>同步非阻塞也没好到哪里去</p>
<p>第一个阶段,虽然没有被阻塞,但是也得不停的轮询,不断发起IO系统调用</p>
<p>第二个阶段，等待复制完成</p>
<p><strong>IO多路复用</strong></p>
<p><img src="https://github.com/TwoAndOne/my-images/raw/master/img/image-20210321195033926.png" alt="image-20210321195033926" style="zoom:67%;" /></p>
<p>IO多路复用本质上还是同步非阻塞</p>
<p>在这种模式中，首先不是进行read系统调动，而是进行select/epoll系统调用。当然，这里有一个前提，需要将目标网络连接，提前注册到select/epoll的可查询socket列表中。然后，才可以开启整个的IO多路复用模型的读流程。</p>
<p>（1）进行select/epoll系统调用，查询可以读的连接。kernel会查询所有select的可查询socket列表，当任何一个socket中的数据准备好了，select就会返回。</p>
<p>当用户进程调用了select，那么整个线程会被block（阻塞掉）。</p>
<p>（2）用户线程获得了目标连接后，发起read系统调用，用户线程阻塞。内核开始复制数据。它就会将数据从kernel内核缓冲区，拷贝到用户缓冲区（用户内存），然后kernel返回结果。</p>
<p>（3）用户线程才解除block的状态，用户线程终于真正读取到数据，继续执行。</p>
<p>多路复用IO的特点：</p>
<p>IO多路复用模型，建立在操作系统kernel内核能够提供的多路分离系统调用select/epoll基础之上的。多路复用IO需要用到两个系统调用（system
call）， 一个select/epoll查询调用，一个是IO的读取调用。</p>
<p>和NIO模型相似，多路复用IO需要轮询。负责select/epoll查询调用的线程，需要不断的进行select/epoll轮询，查找出可以进行IO操作的连接。</p>
<p>另外，多路复用IO模型与前面的NIO模型，是有关系的。对于每一个可以查询的socket，一般都设置成为non-blocking模型。只是这一点，对于用户程序是透明的（不感知）。</p>
<p>多路复用IO的优点：</p>
<p>用select/epoll的优势在于，它可以同时处理成千上万个连接（connection）。与一条线程维护一个连接相比，I/O多路复用技术的最大优势是：系统不必创建线程，也不必维护这些线程，从而大大减小了系统的开销。</p>
<p>Java的NIO（new
IO）技术，使用的就是IO多路复用模型。在linux系统上，使用的是epoll系统调用。</p>
<p>多路复用IO的缺点：</p>
<p>本质上，select/epoll系统调用，属于同步IO，也是阻塞IO。都需要在读写事件就绪后，自己负责进行读写，也就是说这个读写过程是阻塞的。</p>
<p><strong>AIO</strong></p>
<figure>
<img
src="https://github.com/TwoAndOne/my-images/raw/master/img/image-20210321195511679.png"
alt="image-20210321195511679" />
<figcaption aria-hidden="true">image-20210321195511679</figcaption>
</figure>
<p>如果大家学过终端的话就容易理解AIO</p>
<p>第一个阶段,用户态程序执行read调用,如果内核态没数据,那就做其他事情</p>
<p>第二个阶段,内核态把数据复制到了用户态的进程缓冲区后通知用户应用程序</p>
<p>异步IO模型的特点：</p>
<p>在内核kernel的等待数据和复制数据的两个阶段，用户线程都不是block(阻塞)的。用户线程需要接受kernel的IO操作完成的事件，或者说注册IO操作完成的回调函数，到操作系统的内核。所以说，异步IO有的时候，也叫做信号驱动
IO 。</p>
<p>异步IO模型缺点：</p>
<p>需要完成事件的注册与传递，这里边需要底层操作系统提供大量的支持，去做大量的工作。</p>
<p>目前来说， Windows 系统下通过 IOCP 实现了真正的异步
I/O。但是，就目前的业界形式来说，Windows
系统，很少作为百万级以上或者说高并发应用的服务器操作系统来使用。</p>
<p>而在 Linux
系统下，异步IO模型在2.6版本才引入，目前并不完善。所以，这也是在 Linux
下，实现高并发网络编程时都是以 IO 复用模型模式为主。</p>
<p><strong>总结</strong></p>
<p>只有AIO不会阻塞,其他的都会在第二个阶段阻塞.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://twoandone.github.io/2021/03/21/Switch%20jdk8%20jdk17/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Yus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yussss">
      <meta itemprop="description" content="后端废物">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Yussss">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/21/Switch%20jdk8%20jdk17/" class="post-title-link" itemprop="url">Switch jdk8 jdk17</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-21 13:42:25" itemprop="dateCreated datePublished" datetime="2021-03-21T13:42:25+08:00">2021-03-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-18 01:23:24" itemprop="dateModified" datetime="2022-07-18T01:23:24+08:00">2022-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>For the system Java wrappers to find this JDK, symlink it with</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -sfn /opt/homebrew/opt/openjdk/libexec/openjdk.jdk /Library/Java/JavaVirtualMachines/openjdk.jdk</span><br></pre></td></tr></table></figure>
<p>openjdk is keg-only, which means it was not symlinked into
/opt/homebrew, because macOS provides similar software and installing
this software in parallel can cause all kinds of trouble.</p>
<p>If you need to have openjdk first in your PATH, run:
<code>echo 'export PATH="/opt/homebrew/opt/openjdk/bin:$PATH"' &gt;&gt; ~/.zshrc</code></p>
<p>For compilers to find openjdk you may need to set:
<code>export CPPFLAGS="-I/opt/homebrew/opt/openjdk/include"</code></p>
<p>.zshrc
文件修改以下配置，只要输入jdk8就切换jdk8的环境,输入jdk17就切换17 jdk</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_8_HOME=&quot;/Library/Java/JavaVirtualMachines/zulu-8.jdk/Contents/Home/&quot;</span><br><span class="line">export JAVA_17_HOME=&quot;/opt/homebrew/opt/openjdk/libexec/openjdk.jdk/Contents/Home&quot;</span><br><span class="line">alias jdk8=&quot;export JAVA_HOME=$JAVA_8_HOME&quot;</span><br><span class="line">alias jdk17=&quot;export JAVA_HOME=$JAVA_17_HOME&quot;</span><br><span class="line">export JAVA_HOME=$JAVA_8_HOME</span><br><span class="line">export PATH=$PATH:$JAVA_HOME</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://twoandone.github.io/2021/03/20/Genshin%E8%82%9D%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Yus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yussss">
      <meta itemprop="description" content="后端废物">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Yussss">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/20/Genshin%E8%82%9D%E5%BD%95/" class="post-title-link" itemprop="url">Genshin 肝录</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-20 13:42:25" itemprop="dateCreated datePublished" datetime="2021-03-20T13:42:25+08:00">2021-03-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-18 01:24:56" itemprop="dateModified" datetime="2022-07-18T01:24:56+08:00">2022-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/life/" itemprop="url" rel="index"><span itemprop="name">life</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="甘雨">甘雨</h1>
<h3 id="天赋周二周五周日-勤劳的哲学">天赋（周二、周五、周日
勤劳的哲学）</h3>
<p>二段蓄力 霜华矢 霜华绽放 冰元素伤害</p>
<p>E 持续 6s 冷却 10s</p>
<p>Q 持续 15s 冷却 15s 元素能量 60</p>
<h3 id="武器周二周五周日">武器（周二、周五、周日）</h3>
<p>破魔之弓 重击提升 12%</p>
<p><strong>砂之祭场 冬国仕女 射手丘丘人</strong></p>
<h3 id="命座">命座</h3>
<p>饮露 ：二段蓄力降低冰抗 15% 持续 6s</p>
<h3 id="圣遗物">圣遗物</h3>
<p>乐团</p>
<hr />
<h1 id="钟离">钟离</h1>
<h3 id="天赋周三周六周日">天赋（周三、周六、周日）</h3>
<p>E 持续 6s 冷却 10s</p>
<p>Q 持续 3.2s 冷却 12s 元素能量 40</p>
<h3 id="武器周三周六周日">武器（周三、周六、周日）</h3>
<p>黑缨枪 提高生命值</p>
<p><strong>古雷试炼场 龙蜥 射手丘丘人</strong></p>
<h3 id="圣遗物-1">圣遗物</h3>
<p>生命头 生命沙 生命杯</p>
<p>有效词条：生命、充能</p>
<ul>
<li>千岩</li>
<li>宗室</li>
</ul>
<hr />
<h1 id="香菱">香菱</h1>
<h3 id="天赋周二周五周日-勤劳的哲学-1">天赋（周二、周五、周日
勤劳的哲学）</h3>
<h3 id="武器">武器</h3>
<p>渔获 # 钓鱼太烦了</p>
<h3 id="圣遗物-2">圣遗物</h3>
<p>暴击/爆伤头 充能沙 火伤杯</p>
<p>有效词条：充能</p>
<ul>
<li>绝缘</li>
</ul>
<hr />
<h1 id="班尼特">班尼特</h1>
<h3 id="天赋周二周五周日-冰封废渊">天赋（周二、周五、周日
冰封废渊）</h3>
<p>Q 13 级</p>
<h3 id="武器-1">武器</h3>
<p>风鹰剑</p>
<h3 id="圣遗物-3">圣遗物</h3>
<p>治疗头 充能沙 生命杯</p>
<p>有效词条：充能、生命</p>
<ul>
<li>宗室</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://twoandone.github.io/2021/03/20/HashMap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Yus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yussss">
      <meta itemprop="description" content="后端废物">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Yussss">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/20/HashMap/" class="post-title-link" itemprop="url">HashMap</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-20 13:42:25" itemprop="dateCreated datePublished" datetime="2021-03-20T13:42:25+08:00">2021-03-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-18 01:03:29" itemprop="dateModified" datetime="2022-07-18T01:03:29+08:00">2022-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>介绍一下HashMap吧</p>
<p>那我首先说一下它<strong>能干什么</strong>,hashmap实现了map接口,那肯定能存储键值对,它允许null键但只能有一个,null值可以有多个,线程不安全,不保证有序,因为根据hashcode值存储数据,大多数时候可以直接定位到它的值,所以具有很快的访问速度.</p>
<p>从<strong>结构实现</strong>上看,hashmap是由数组,链表,红黑树实现的,红黑树是jdk8引进的.</p>
<p>hashmap最基本的方法是<strong>get和put方法</strong>,get是取,put是存.</p>
<p>怎么取呢?也就是<strong>get()方法的工作原理</strong>是啥.</p>
<p>在调用get方法时,我们会传入key,然后get方法内部会先调用hash方法算出hash值,也就是下标然后再调用getnode方法,接着判断链表的第一个位置存储的元素是不是要找的元素,如果不是,还会判断下一个是不是为空,为空就返回null,不为空还得判断链表的第一个结点是否是treenode的结点,如果是就继续treenode的get方法,如果不是就遍历链表来获取结点.</p>
<p>put方法呢,首先判断键值对数组table是否为空,如果是就得扩容,否就根据键值key计算hash值得到插入的数组索引,得到索引就判断这个位置是否空,空就直接插入,当然插入也得看此时的size是否大于threshold大于就还得扩容,然后回到这个不空的情况来,不空的话就得判断这个位置的key是否和给定的key相同,相同就直接覆盖,不相同就得再后面排队了,排队也得分情况,判断第一个结点是不是红黑树的结点,是红黑树就得用红黑树的方式插入,不是就直接在链表里插入,在链表里插入也得考虑此时的链表长度是否大于8,大于8就得转换为红黑树,不大于8就链表插入,key存在就直接覆盖.</p>
<figure>
<img
src="https://github.com/TwoAndOne/my-images/raw/master/img/image-20210320164108937.png"
alt="image-20210320164108937" />
<figcaption aria-hidden="true">image-20210320164108937</figcaption>
</figure>
<p>说了这么多次,根据key计算数组索引,接下来讲讲怎么计算索引吧.</p>
<p>第一步取key的hashCode值,第二步高位运算,第三步取模运算.</p>
<p><strong>HashMap的长度为什么是2的幂次方</strong></p>
<p>可能是Doug Lea太厉害了,hashmap的作者,哈哈哈.</p>
<p>不开玩笑了,为了让hashmap存储高效就得把哈希函数映射得比较均匀分散以避免哈希碰撞,但hashmap是有容量的,为了保证得到的索引值在容量范围内就得对散列值进行取余,但是取余运算符效率太低,为了能够让位运算实现取余操作,必须保证hashmap的长度也就是取模运算的模数必须为2的幂.<strong>(length
- 1) &amp; hash</strong></p>
<p><strong>HashMap怎么扩容</strong></p>
<p>因为Java里的数组无法自动扩容,方法是使用一个新的数组代替已有的容量小的数组.</p>
<p>大致分两步:1
,容量扩充为原来的两倍,2,对每个结点重新计算哈希值,重新计算索引位置,将原来的元素移动到新的哈希表中.</p>
<p><strong>HashMap与HashTable的区别</strong>k</p>
<p>作者不一样,Doug Lea没有参与HashTable的编写</p>
<p>　　1.HashMap继承于AbstractMap，而Hashtable继承于Dictionary；
　　2.线程安全不同。Hashtable的几乎所有函数都是同步的，即它是线程安全的，支持多线程。而HashMap的函数则是非同步的，它不是线程安全的。若要在多线程中使用HashMap，需要我们额外的进行同步处理；
　　3.null值。HashMap的key、value都可以为null。Hashtable的key、value都不可以为null；
　　4.迭代器(Iterator)。HashMap的迭代器(Iterator)是fail-fast迭代器，而Hashtable的enumerator迭代器不是fail-fast的。所以当有其它线程改变了HashMap的结构（增加或者移除元素），将会抛出ConcurrentModificationException。
　　5.容量的初始值和增加方式都不一样：HashMap默认的容量大小是16；增加容量时，每次将容量变为“原始容量x2”。Hashtable默认的容量大小是11；增加容量时，每次将容量变为“原始容量x2
+ 1”；
　　6.添加key-value时的hash值算法不同：HashMap添加元素时，是使用自定义的哈希算法。Hashtable没有自定义哈希算法，而直接采用的key的hashCode()。
　　7.速度。由于Hashtable是线程安全的也是synchronized，所以在单线程环境下它比HashMap要慢。如果你不需要同步，只需要单一线程，那么使用HashMap性能要好过Hashtable。</p>
<p>参考:</p>
<p>https://tech.meituan.com/2016/06/24/java-hashmap.html</p>
<p>https://snailclimb.gitee.io/javaguide/#/docs/java/collection/Java%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98?id=_146-hashmap-%e7%9a%84%e9%95%bf%e5%ba%a6%e4%b8%ba%e4%bb%80%e4%b9%88%e6%98%af-2-%e7%9a%84%e5%b9%82%e6%ac%a1%e6%96%b9</p>
<p>https://blog.csdn.net/u012512634/article/details/72735183</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://twoandone.github.io/2021/03/20/RocketMQ%E5%AE%89%E8%A3%85(windows)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Yus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yussss">
      <meta itemprop="description" content="后端废物">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Yussss">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/20/RocketMQ%E5%AE%89%E8%A3%85(windows)/" class="post-title-link" itemprop="url">RocketMQ 安装 （windows）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-20 13:42:25" itemprop="dateCreated datePublished" datetime="2021-03-20T13:42:25+08:00">2021-03-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-18 01:21:46" itemprop="dateModified" datetime="2022-07-18T01:21:46+08:00">2022-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>按照官网的步骤，坑死我了，耗费好几个小时。</p>
<p>官网地址：https://rocketmq.apache.org/docs/quick-start/</p>
<ol type="1">
<li><p><img
src="https://github.com/TwoAndOne/my-images/raw/master/uPic/image-20220317174007720.png"
alt="image-20220317174007720" />在官网的页面上，点击下载</p></li>
<li><p>```powershell 解压 rocketmq-all-4.9.3-source-release.zip
进入这个目录 rocketmq-all-4.9.3/ 打开 cmd 然后执行后面的命令：mvn
-Prelease-all -DskipTests clean install -U <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. 这时候你可以在 rocketmq-all-4.9.3 目录看见`distribution\target\rocketmq-4.9.3\rocketmq-4.9.3\bin` 这个目录。</span><br><span class="line">   ![image-20220317174809910](https://gitee.com/yuswork/my-images/raw/master/uPic/image-20220317174809910.png)进入这个目录之后，你会看到 mqnamesrv.cmd，这就可以表明你已经编译成功了。</span><br><span class="line"></span><br><span class="line">   其实你可以先试一下运行这个`mqnamesrv.cmd` 能不能成功，不能成功再用我下面的方法。直接在命令行输入 `mqnamesrv.cmd`。</span><br><span class="line"></span><br><span class="line">4. 下一步，我们去配置环境变量，直接点击 win 按钮，输入环境变量四个字就可以看见编辑环境变量的选项</span><br><span class="line"></span><br><span class="line">   ```powershell</span><br><span class="line">   # 在系统变量那里选择编辑</span><br><span class="line">   ROCKETMQ_HOME=&quot;xxx\distribution\target\rocketmq-4.9.3\rocketmq-4.9.3&quot;</span><br><span class="line">   NAMESRV_ADDR=&quot;localhost:9876&quot;</span><br><span class="line">   # 重新打开 cmd 然后运行下述命令，查看是否配置成功 </span><br><span class="line">   set ROCKETMQ_HOME</span><br></pre></td></tr></table></figure></p></li>
<li><p>OK，重新回到<code>distribution\target\rocketmq-4.9.2\rocketmq-4.9.2\bin</code>目录，用记事本打开
runserver.cmd。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置一个变量</span></span><br><span class="line"><span class="built_in">set</span> JAVAHOME=<span class="string">&quot;%JAVA_HOME%&quot;</span></span><br><span class="line"><span class="comment"># 然后找到这一行 把 JAVA_HOME 替换成 JAVAHOME</span></span><br><span class="line"><span class="built_in">set</span> <span class="string">&quot;JAVA_OPT=%JAVA_OPT% -Djava.ext.dirs=%BASE_DIR%lib;%JAVAHOME%\jre\lib\ext&quot;</span></span><br><span class="line"><span class="comment"># 找到这一行，删掉 CLASSPATH 外面的引号</span></span><br><span class="line"><span class="built_in">set</span> <span class="string">&quot;JAVA_OPT=%JAVA_OPT% -cp %CLASSPATH%</span></span><br></pre></td></tr></table></figure>
<p>为什么这么做呢？</p>
<p>因为 JAVA_HOME、CLASSPATH、PATH 里都不能有空格，我们配置的
JAVA_HOME的地址一般都是<code>D:\Program Files\xxx</code>
这里面就有空格，所以我们再设置一个变量很巧妙的解决了这个问题。</p>
<p>CLASSPATH 写在外面就包引号，写在引号里面就不用再加引号了。</p></li>
<li><p>再一次回到
<code>distribution\target\rocketmq-4.9.2\rocketmq-4.9.2\bin</code>
目录，运行 <code>mqnamesrv.cmd</code>,如果看到，就可以了</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The Name Server boot success. </span><br></pre></td></tr></table></figure></li>
<li><p>关闭 最简单的方式是直接关掉这几个窗口
但是你也可以用<code>mqshutdown.cmd broker | namesrv</code>
其实意思是一样的，查看 <code>mqshutdown.cmd</code> 会发现它也是直接 kill
掉</p></li>
</ol>
<p><strong>备注</strong> set ROCKETMQ_HOME 可以看环境变量</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://twoandone.github.io/2021/03/14/The%20north%20of%20workplace/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Yus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yussss">
      <meta itemprop="description" content="后端废物">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Yussss">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/14/The%20north%20of%20workplace/" class="post-title-link" itemprop="url">The north of workplace</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-14 13:42:25" itemprop="dateCreated datePublished" datetime="2021-03-14T13:42:25+08:00">2021-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-18 01:31:22" itemprop="dateModified" datetime="2022-07-18T01:31:22+08:00">2022-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/life/" itemprop="url" rel="index"><span itemprop="name">life</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure>
<img
src="https://github.com/TwoAndOne/my-images/raw/master/uPic/jKMrm0.png"
alt="jKMrm0" />
<figcaption aria-hidden="true">jKMrm0</figcaption>
</figure>
<h2 id="section">2022-2023</h2>
<ul>
<li>技术</li>
<li>业务</li>
<li>管理</li>
</ul>
<h3 id="技术">技术</h3>
<p>提升技术的两个误区</p>
<ol type="1">
<li>错误理解基础二字
<ul>
<li>基础是和工作任务相关的基础而不是计算机行业的基础</li>
</ul></li>
<li>碎片化学习
<ul>
<li>正确的做法是碎片化时间，系统化学习。</li>
<li>对照一本经典的书籍循序渐进的学习</li>
</ul></li>
</ol>
<h3 id="业务">业务</h3>
<p>熟悉各项业务的处理逻辑</p>
<p>让自己成为产品的深度用户</p>
<blockquote>
<p>有些技术人员连自己负责的产品都不用，只是机械地按照项目的要求完成任务。功能上线后，他们既不亲自体验，也不关心用户的反馈。这样做的后果是连基本的业务现状都很难清晰了解，跟别提升业务水平了。
如果你对你现在做的业务一点兴趣都没有，建议你尽早换行</p>
</blockquote>
<h3 id="管理">管理</h3>
<p>暂时不用管</p>
<h2 id="如何计划">如何计划</h2>
<figure>
<img
src="https://github.com/TwoAndOne/my-images/raw/master/uPic/dAOc1U.png"
alt="dAOc1U" />
<figcaption aria-hidden="true">dAOc1U</figcaption>
</figure>
<p>分解任务</p>
<p>参考职级划分标准或公司职级体系，在当前标准与大佬间划分等级。</p>
<p>把2<del>3年的目标分解成6个月的目标，整理下一等级的技能需求，列出重点提升的3</del>5个技能点</p>
<p>把6个月的目标分解成1~2个月的目标，确定具体的行动</p>
<p>执行计划时落实到周</p>
<h2 id="如何学习">如何学习</h2>
<figure>
<img
src="https://github.com/TwoAndOne/my-images/raw/master/uPic/Ip3TVL.png"
alt="Ip3TVL" />
<figcaption aria-hidden="true">Ip3TVL</figcaption>
</figure>
<p>最好的验证方式，将这个知识教给别人</p>
<h2 id="技术团队okr">技术团队OKR</h2>
<ul>
<li>解决问题</li>
<li>优化性能</li>
<li>引入新技术</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://twoandone.github.io/2021/03/06/%E5%BE%AE%E6%9C%8D%E5%8A%A1-Martin-Fowler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Yus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yussss">
      <meta itemprop="description" content="后端废物">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Yussss">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/06/%E5%BE%AE%E6%9C%8D%E5%8A%A1-Martin-Fowler/" class="post-title-link" itemprop="url">微服务|Martin Fowler</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-06 17:30:44" itemprop="dateCreated datePublished" datetime="2021-03-06T17:30:44+08:00">2021-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-03-28 13:52:09" itemprop="dateModified" datetime="2021-03-28T13:52:09+08:00">2021-03-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>作者：Martin Fowler &amp; James Lewis 译者：伍斌</p>
<h3 id="微服务">微服务</h3>
<p>“微服务架构”这一术语在前几年横空出世，用于描述这样一种特定的软件设计方法，即以若干组可独立部署的服务的方式进行软件应用系统的设计。尽管这种架构风格尚无明确的定义，但其在下述方面还是存在一定的共性，即围绕业务功能的组织、自动化部署、端点智能、以及在编程语言和数据方面进行去中心化的控制。</p>
<h3 id="本文目录">本文目录</h3>
<ul>
<li>微服务架构的九大特性
<ul>
<li>特性一：“组件化”与“多服务”</li>
<li>特性二：围绕“业务功能”组织团队</li>
<li>特性三：“做产品”而不是“做项目”</li>
<li>特性四：“智能端点”与“傻瓜管道”</li>
<li>特性五：“去中心化”地治理技术</li>
<li>特性六：“去中心化”地管理数据</li>
<li>特性七：“基础设施”自动化</li>
<li>特性八：“容错”设计</li>
<li>特性九：“演进式”设计</li>
</ul></li>
<li>未来的方向是“微服务”吗？</li>
</ul>
<hr />
<p>“微服务”——这是在“软件架构”这条熙熙攘攘的大街上出现的又一个新词语。我们很容易对它不屑一顾，但是这个小小的术语却描述了一种引人入胜的软件系统风格。在近几年中，我们越来越多的看到许多项目使用了这种风格，而且就目前来说结果都是不错的，以至于许多ThoughtWorker都把它看作构建企业应用系统的默认风格。然而，很不幸的是，我们找不到有关它的概要信息，即什么是微服务风格，以及如何设计微服务风格的架构。</p>
<p>简而言之，微服务架构风格[1]这种开发方法，是以开发一组小型服务的方式来开发一个独立的应用系统。其中每个小型服务都运行在自己的进程中，并经常采用HTTP资源API这样轻量的机制来相互通信。这些服务围绕业务功能进行构建，并能通过全自动的部署机制来进行独立部署。这些微服务可以使用不同的语言来编写，并且可以使用不同的数据存储技术。对这些微服务，我们仅做最低限度的集中管理。</p>
<p>在开始介绍微服务风格之前，将其与单块（monolithic）风格进行对比还是很有意义的：一个单块应用系统是以一个单个单元的方式来构建的。企业应用系统经常包含三个主要部分：客户端用户界面、数据库和服务端应用系统。客户端用户界面包括HTML页面和运行在用户机器的浏览器中的JavaScript。数据库中包括许多表，这些表被插入一个公共的且通常为关系型的数据库管理系统中。这个服务端的应用系统就是一个单块应用——一个单个可执行的逻辑程序[2]。对于该系统的任何改变，都会涉及构建和部署上述服务端应用系统的一个新版本。</p>
<p>这样的单块服务器是构建上述系统的一种自然的方式。处理用户请求的所有逻辑都运行在一个单个的进程内，因此能使用编程语言的基本特性，来把应用系统划分为类、函数和命名空间。通过精心设计，得以在开发人员的笔记本电脑上运行和测试这样的应用系统，并且使用一个部署流水线来确保变更被很好地进行了测试，并被部署到生产环境中。通过负载均衡器运行许多实例，来将这个单块应用进行横向扩展。</p>
<p>单块应用系统可以被成功地实现，但是渐渐地，特别是随着越来越多的应用系统正被部署到云端，人们对它们开始表现出不满。软件变更受到了很大的限制，应用系统中一个很小部分的一处变更，也需要将整个单块应用系统进行重新构建和部署。随着时间的推移，单块应用逐渐难以保持一个良好的模块化结构，这使得它变得越来越难以将一个模块的变更所产生的影响控制在该模块内。当对系统进行扩展时，不得不扩展整个应用系统，而不能仅扩展该系统中需要更多资源的那些部分。</p>
<figure>
<img
src="http://insights.thoughtworks.cn/wp-content/uploads/2017/10/1-monoliths-vs-microservices-1-700x428.png"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>图1: 单块应用和微服务</p>
<p>这些不满催生出了微服务架构风格：以构建一组小型服务的方式来构建应用系统。除了这些服务能被独立地部署和扩展之外，每一个服务还能提供一个稳固的模块边界，甚至能允许使用不同的编程语言来编写不同的服务。这些服务也能被不同的团队来管理。</p>
<p>我们并不认为微服务风格是一个新颖或创新的概念，它的起源至少可以追溯到Unix的设计原则。但是我们觉得，考虑微服务架构的人还不够多，并且如果对其加以使用，许多软件的开发工作能变得更好。</p>
<h3 id="微服务架构的九大特性">微服务架构的九大特性</h3>
<p>虽然不能说存在微服务架构风格的正式定义，但是可以尝试描述我们所见到的、能够被贴上“微服务”标签的那些架构的共性。下面所描述的这些共性，并不是所有的微服务架构都完全具备，但是我们确实期望大多数微服务架构都具备这些共性中的大多数特性。尽管我们两位作者已经成为这个相当松散的社区中的活跃成员，但我们的本意还是描述我们两人在自己所在和所了解的团队工作中所看到的情况。特别要指出，我们不会制定大家需要遵循的微服务的定义。</p>
<h4 id="特性一组件化与多服务">特性一：“组件化”与“多服务”</h4>
<p>自我们从事软件行业以来，发现大家都有“把组件插在一起来构建系统”的愿望，就像在物理世界中所看到的那样。在过去几十年中，我们已经看到，在公共软件库方面已经取得了相当大的进展，这些软件库是大多数编程语言平台的组成部分。</p>
<p>当谈到组件时，会碰到一个有关定义的难题，即什么是组件？我们的定义是：一个组件就是一个可以独立更换和升级的软件单元。</p>
<p>微服务架构也会使用软件库，但其将自身软件进行组件化的主要方法是将软件分解为诸多服务。我们将软件库(libraries)定义为这样的组件，即它能被链接到一段程序，且能通过内存中的函数来进行调用。然而，服务(services)是进程外的组件，它们通过诸如web
service请求或远程过程调用这样的机制来进行通信（这不同于许多面向对象的程序中的service
object概念[3]）。</p>
<p>以使用服务（而不是以软件库）的方式来实现组件化的一个主要原因是，服务可被独立部署。如果一个应用系统[4]由在单个进程中的多个软件库所组成，那么对任一组件做一处修改，都不得不重新部署整个应用系统。但是如果该应用系统被分解为多个服务，那么对于一个服务的多处修改，仅需要重新部署这一个服务。当然这也不是绝对的，一些变更服务接口的修改会导致多个服务之间的协同修改。但是一个良好的微服务架构的目的，是通过内聚的服务边界和服务协议方面的演进机制，来将这样的修改变得最小化。</p>
<p>以服务的方式来实现组件化的另一个结果，是能获得更加显式的（explicit）组件接口。大多数编程语言并没有一个良好的机制来定义显式的<a
target="_blank" rel="noopener" href="https://martinfowler.com/bliki/PublishedInterface.html">发布接口</a>。通常情况下，这样的接口仅仅是文档声明和团队纪律，来避免客户端破坏组件的封装，从而导致组件间出现过度紧密的耦合。通过使用显式的远程调用机制，服务能更容易地规避这种情况。</p>
<p>如此使用服务，也会有不足之处。比起进程内调用，远程调用更加昂贵。所以远程调用API接口必须是粗粒度的，而这往往更加难以使用。如果需要修改组件间的职责分配，那么当跨越进程边界时，这种组件行为的改动会更加难以实现。</p>
<p>近似地，我们可以把一个个服务映射为一个个运行时的进程，但这仅仅是一个近似。一个服务可能包括总是在一起被开发和部署的多个进程，比如一个应用系统的进程和仅被该服务使用的数据库。</p>
<h4 id="特性二围绕业务功能组织团队">特性二：围绕“业务功能”组织团队</h4>
<p>当在寻求将一个大型应用系统分解成几部分时，公司管理层往往会聚焦在技术层面上，这就意味着要组建用户界面团队、服务器端团队和数据库团队。当团队沿着这些技术线分开后，即使要实现软件中一个简单的变更，也会发生跨团队的项目时延和预算审批。在这种情况下，聪明的团队会进行局部优化，“两害相权取其轻”，来直接把代码逻辑塞到他们能访问到的任意应用系统中。换句话说，这种情况会导致代码逻辑散布在系统各处。这就是康威定律[5]的鲜活实例。</p>
<blockquote>
<p>任何设计（广义上的）系统的组织，都会产生这样一个设计，即该设计的结构与该组织的沟通结构相一致。——梅尔文•康威（Melvyn
Conway）, 1967年</p>
</blockquote>
<figure>
<img
src="http://insights.thoughtworks.cn/wp-content/uploads/2017/10/2-Conways-law.png"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>图2：康威定律在起作用</p>
<p>微服务使用不同的方法来分解系统，即根据业务功能（business
capability）来将系统分解为若干服务。这些服务针对该业务领域提供多层次、广泛的软件实现，包括用户界面、持久性存储以及任何对外的协作性操作。因此，团队是跨职能的，它拥有软件开发所需的全方位的技能：用户体验、数据库和项目管理。</p>
<figure>
<img
src="http://insights.thoughtworks.cn/wp-content/uploads/2017/10/3-Service-boundaries-reinforced-by-team-boundaries-700x397.png"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>图3：被团队边界所强化的服务边界</p>
<p>以上述方式来组织团队的公司是<a
target="_blank" rel="noopener" href="https://insights.thoughtworks.cn/microservices-martin-fowler/www.comparethemarket.com">www.comparethemarket.com</a>。跨职能团队负责构建和运维每个产品，而每个产品被拆分为多个独立的服务，彼此通过一个消息总线来通信。</p>
<blockquote>
<p><strong>一个微服务应该有多大？</strong></p>
<p>尽管许多人已经习惯于用“微服务”来概括描述这种这种架构风格，但是这个名字确实会不幸地引发大家对服务规模的关注，并且产生有关什么是“微”的争论。在与微服务从业者的交谈中，我们看到了有关服务的一系列规模。所听到的最大的一个服务规模，是遵循了亚马逊的“两个比萨团队”（即一个团队可以被两个比萨所喂饱）的理念所形成的，这意味着这个团队不会多于12人。对于规模较小的服务，我们已经看到一个6人的团队在支持6个服务。</p>
<p>这引出了一个问题，即“每12人做一个服务”和“每人做一个服务”这样有关服务规模的差距，是否已经大到不能将两者都纳入微服务之下？此时，我们认为最好还是把它们归为一类，但是随着探索的深入，我们将来极有可能会改变主意。</p>
</blockquote>
<p>大型单块应用系统也可以始终根据业务功能来进行模块化设计，虽然这并不常见。当然，我们会敦促构建单块应用系统的大型团队根据业务线来将自己分解为若干小团队。在这方面，我们已经看到的主要问题是，他们往往是一个团队包含了太多的业务功能。如果这个“单块”跨越了许多模块的边界，那么这个团队的每一个成员都难以记住所有模块的业务功能。此外，我们看到这些模块的边界需要大量的团队纪律来强制维持。而实现组件化的服务所必要的更加显式的边界，能更加容易地保持团队边界的清晰性。</p>
<h4 id="特性三做产品而不是做项目">特性三：“做产品”而不是“做项目”</h4>
<p>我们所看的大部分应用系统的开发工作都使用项目模型：目标是交付某一块软件，之后就认为完工了。一旦完工后，软件就被移交给维护团队，接着那个构建该软件的项目团队就会被解散。</p>
<p>微服务的支持者们倾向于避免使用上述模型，而宁愿采纳“一个团队在一个产品的整个生命周期中都应该保持对其拥有”的理念。通常认为这一点源自亚马逊的“<a
target="_blank" rel="noopener" href="https://queue.acm.org/detail.cfm?id=1142065">谁构建，谁运行</a>”的理念，即一个开发团队对一个在生产环境下运行的软件负全责。这会使开发人员每天都关注软件是如何在生产环境下运行的，并且增进他们与用户的联系，因为他们必须承担某些支持工作。</p>
<p>这样的“产品”理念，是与业务功能的联动绑定在一起的。它不会将软件看作是一个待完成的功能集合，而是认为存在这样一个持续的关系，即软件如何能助其客户来持续增进业务功能。</p>
<p>当然，单块应用系统的开发工作也可以遵循上述“产品”理念，但是更细粒度的服务，能让服务的开发者与其用户之间的个人关系的创建变得更加容易。</p>
<h4 id="特性四智能端点与傻瓜管道">特性四：“智能端点”与“傻瓜管道”</h4>
<p>当在不同的进程之间构建各种通信结构时，我们已经看到许多产品和方法，来强调将大量的智能特性纳入通信机制本身。其中一个典型例子，就是“企业服务总线”(Enterprise
Service Bus,
ESB)。ESB产品经常包括高度智能的设施，来进行消息的路由、编制(choreography)、转换，并应用业务规则。</p>
<p>微服务社区主张采用另一种做法：智能端点(smart
endpoints)和傻瓜管道(dumb
pipes)。使用微服务所构建的各个应用的目标，都是尽可能地实现“高内聚和低耦合”——他们拥有自己的领域逻辑，并且更像是经典Unix的“过滤器”(filter)那样来工作——即接收一个请求，酌情对其应用业务逻辑，并产生一个响应。这些应用通过使用一些简单的REST风格的协议来进行编制，而不去使用诸如下面这些复杂的协议，即"WS-编制"(WS-Choreography)、BPEL或通过位于中心的工具来进行编排(orchestration)。</p>
<p>微服务最常用的两种协议是：带有资源API的HTTP“请求－响应”协议，和轻量级的消息发送协议[6]。对于前一种协议的最佳表述是：</p>
<blockquote>
<p>成为Web，而不是躲着Web (Be of the web, not behind the web)——Ian
Robinson</p>
</blockquote>
<p>这些微服务团队在开发中，使用在构建万维网(world wide
web)时所使用的原则和协议（并且在很大程度上，这些原则和协议也是在构建Unix系统时所使用的）。那些被使用过的HTTP资源，通常能被开发或运维人员轻易地缓存起来。</p>
<p>最常用的第二种协议，是通过一个轻量级的消息总线来进行消息发送。此时所选择的基础设施，通常是“傻瓜”(dumb)型的(仅仅像消息路由器所做的事情那样傻瓜)——像RabbitMQ或ZeroMQ那样的简单实现，即除了提供可靠的异步机制(fabric)以外不做其他任何事情——智能功能存在于那些生产和消费诸多消息的各个端点中，即存在于各个服务中。</p>
<p>在一个单块系统中，各个组件在同一个进程中运行。它们相互之间的通信，要么通过方法调用，要么通过函数调用来进行。将一个单块系统改造为若干微服务的最大问题，在于对通信模式的改变。仅仅将内存中的方法调用转换为RPC调用这样天真的做法，会导致微服务之间产生繁琐的通信，使得系统表现变糟。取而代之的是，需要用更粗粒度的协议来替代细粒度的服务间通信。</p>
<h4 id="特性五去中心化的治理技术">特性五：“去中心化”的治理技术</h4>
<p>使用中心化的方式来对开发进行治理，其中一个后果，就是趋向于在单一技术平台上制定标准。经验表明，这种做法会带来局限性——不是每一个问题都是钉子，不是每一个方案都是锤子。我们更喜欢根据工作的不同来选用合理的工具。尽管那些单块应用系统能在一定程度上利用不同的编程语言，但是这并不常见。</p>
<p>如果能将单块应用的那些组件拆分成多个服务，那么在构建每个服务时，就可以有选择不同技术栈的机会。想要使用Node.js来搞出一个简单的报表页面？尽管去搞。想用C++来做一个特别出彩的近乎实时的组件？没有问题。想要换一种不同风格的数据库，来更好地适应一个组件的读取数据的行为？可以重建。</p>
<blockquote>
<p><strong>微服务和SOA</strong></p>
<p>当我们谈起微服务时，一个常见的问题就会出现：是否微服务仅仅是十多年前所看到的“面向服务的架构”(Service
Oriented Architecture,
SOA)？这样问是有道理的，因为微服务风格非常类似于一些支持SOA的人所赞成的观点。然而，问题在于<a
target="_blank" rel="noopener" href="https://martinfowler.com/bliki/ServiceOrientedAmbiguity.html">SOA这个词儿意味着太多不同的东西</a>。而且大多数时候，我们所遇到的某些被称作"SOA"的事物，明显不同于本文所描述的风格。这通常由于它们专注于ESB，来集成各个单块应用。</p>
<p>特别地，我们已经看到如此之多的面向服务的拙劣实现——从将系统复杂性隐藏于ESB中的趋势[7]，到花费数百万进行多年却没有交付任何价值的失败项目，到顽固抑制变化发生的中心化技术治理模型——以至于有时觉得其所造成的种种问题真的不堪回首。</p>
<p>当然，在微服务社区投入使用的许多技术，源自各个开发人员将各种服务集成到各个大型组织的经验。“<a
target="_blank" rel="noopener" href="https://martinfowler.com/bliki/TolerantReader.html">容错读取</a>”(Tolerant
Reader)模式就是这样一个例子。对于Web的广泛使用，使得人们不再使用一些中心化的标准，而使用一些简单的协议。坦率地说，这些中心化的标准，其复杂性已经达到令人吃惊的程度。（任何时候，如果需要一个本体来管理其他各个本体，那么麻烦就大了。）</p>
<p>这种常见的SOA表现，已使得一些微服务的倡导者完全拒绝将自己贴上SOA的标签。尽管其他人会将微服务看作是SOA的一种形式[8]，也许微服务就是以正确的形式来实现面向服务的SOA。不管是哪种情况，SOA意味着如此之多的不同事物，这表明用一个更加干净利落的术语来命名这种架构风格是很有价值的。</p>
</blockquote>
<p>当然，仅仅能做事情，并不意味着这些事情就应该被做——不过用微服务的方法把系统进行拆分后，就拥有了技术选型的机会。</p>
<p>相比选用业界一般常用的技术，构建微服务的那些团队更喜欢采用不同的方法。与其选用一组写在纸上已经定义好的标准，他们更喜欢编写一些有用的工具，来让其他开发者能够使用，以便解决那些和他们所面临的问题相似的问题。这些工具通常源自他们的微服务实施过程，并且被分享到更大规模的组织中，这种分享有时会使用内部开源的模式来进行。事实上，现在git和github已经成为首选版本控制系统。在企业内部，开源的做法正在变得越来越普遍。</p>
<p>Netflix公司是遵循上述理念的好例子。将实用且经过实战检验的代码以软件库的形式共享出来，能鼓励其他开发人员以相似的方式来解决相似的问题，当然也为在需要的时候选用不同的方案留了一扇门。共享软件库往往聚焦于解决这样的常见问题，即数据存储、进程间的通信和下面要进一步讨论的基础设施的自动化。</p>
<p>对于微服务社区来说，日常管理开销这一点不是特别吸引人。这并不是说这个社区并不重视服务契约。恰恰相反，它们在社区里出现得更多。这正说明这个社区正在寻找对其进行管理的各种方法。像“容错读取”和“<a
target="_blank" rel="noopener" href="https://martinfowler.com/articles/consumerDrivenContracts.html">消费者驱动的契约</a>”(Consumer-Driven
Contracts)这样的模式，经常被运用到微服务中。这些都有助于服务契约进行独立演进。将执行“消费者驱动的契约”做为软件构建的一部分，能增强开发团队的信心，并提供所依赖的服务是否正常工作的快速反馈。实际上，我们了解到一个在澳洲的团队就是使用“消费者驱动的契约”来驱动构建多个新服务的。他们使用了一些简单的工具，来针对每一个服务定义契约。甚至在新服务的代码编写之前，这件事就已经成为自动化构建的一部分了。接下来服务仅被构建到刚好能满足契约的程度——这是一个在构建新软件时避免YAGNI[9]困境的优雅方法。这些技术和工具在契约周边生长出来，由于减少了服务之间在时域(temporal)上的耦合，从而抑制了对中心契约管理的需求。</p>
<blockquote>
<p>多种编程语言，多种选择可能</p>
<p>做为一个平台，JVM的发展仅仅是一个将各种编程语言混合到一个通用平台的最新例证。近十年以来，通过在平台外层实现更高层次的编程语言，来利用更高层次的抽象，已经成为一个普遍做法。同样，在平台底层以更低层次的编程语言编写性能敏感的代码也很普遍。然而，许多单块系统并不需要这种级别的性能优化，另外DSL和更高层次的抽象也不常用（这令我们感到失望）。相反，许多单块应用通常就使用单一编程语言，并且有对所使用的技术数量进行限制的趋势[10]。</p>
</blockquote>
<p>或许去中心化地治理技术的极盛时期，就是亚马逊的“谁构建，谁运行”的理念开始普及的时候。各个团队负责其所构建的软件的所有工作，其中包括7x24地对软件进行运维。“将运维这一级别的职责下放到团队”这种做法，目前绝对不是主流。但是我们确实看到越来越多的公司，将运维的职责交给各个开发团队。Netflix就是已经形成这种风气的另一个组织[11]。避免每天凌晨3点被枕边的寻呼机叫醒，无疑是在程序员编写代码时令其专注质量的强大动力。而这些想法，与那些传统的中心化技术治理的模式具有天壤之别。</p>
<h4 id="特性六去中心化地管理数据">特性六：“去中心化”地管理数据</h4>
<p>去中心化地管理数据，其表现形式多种多样。从最抽象的层面看，这意味着各个系统对客观世界所构建的概念模型各不相同。当在一个大型的企业中进行系统集成时，这是一个常见的问题。比如对于“客户”这个概念，从销售人员的视角看，就与从支持人员的视角看有所不同。从销售人员的视角所看到的一些被称之为“客户”的事物，或许在支持人员的视角中根本找不到。而那些在两个视角中都能看到的事物，或许各自具有不同的属性。更糟糕的是，那些在两个视角中具有相同属性的事物，或许在语义上有微妙的不同。</p>
<p>上述问题在不同的应用程序之间经常出现，同时也会出现在这些应用程序内部，特别是当一个应用程序被分成不同组件时就会出现。思考这类问题的一个有效方法，就是使用领域驱动设计（Domain-Driven
Design, DDD）中的“<a
target="_blank" rel="noopener" href="https://martinfowler.com/bliki/BoundedContext.html">限界上下文</a>”（Bounded
Context）的概念。DDD将一个复杂的领域划分为多个限界上下文，并且将其相互之间的关系用图画出来。这一划分过程对于单块和微服务架构两者都是有用的，而且就像前面有关“业务功能”一节中所讨论的那样，在服务和各个限界上下文之间所存在的自然的联动关系，有助于澄清和强化这种划分。</p>
<blockquote>
<p><strong>“实战检验”的标准与“强制执行”的标准</strong></p>
<p>微服务的下述做法有点泾渭分明的味道，即他们趋向于避开被那些企业架构组织所制定的硬性实施标准，而愉快地使用甚至传播一些开放标准，比如HTTP、ATOM和其他微格式的协议。</p>
<p>这里的关键区别是，这些标准是如何被制定以及如何被实施的。像诸如IETF这样的组织所管理的各种标准，只有达到下述条件才能称为标准，即该标准在全球更广阔的地区有一些正在运行的实现案例，而且这些标准经常源自一些成功的开源项目。</p>
<p>这些标准组成了一个世界，它区别于来自下述另一个世界的许多标准，即企业世界。企业世界中的标准，经常由这样特点的组织来开发，即缺乏用较新技术进行编程的经验，或受到供应商的过度影响。</p>
</blockquote>
<p>如同在概念模型上进行去中心化的决策一样，微服务也在数据存储上进行去中心化的决策。尽管各个单块应用更愿意在逻辑上各自使用一个单独的数据库来持久化数据，但是各家企业往往喜欢一系列单块应用共用一个单独的数据库——许多这样的决策是被供应商的各种版权商业模式所驱动出来的。微服务更喜欢让每一个服务来管理其自有数据库。其实现可以采用相同数据库技术的不同数据库实例，也可以采用完全不同的数据库系统。这种方法被称作“<a
target="_blank" rel="noopener" href="https://martinfowler.com/bliki/PolyglotPersistence.html">多语种持久化</a>”(Polyglot
Persistence)。在一个单块系统中也能使用多语种持久化，但是看起来这种方法在微服务中出现得更加频繁。</p>
<figure>
<img
src="http://insights.thoughtworks.cn/wp-content/uploads/2017/10/4-application-databases-700x434.png"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>图4：微服务更喜欢让每一个服务来管理其自有数据库</p>
<p>在各个微服务之间将数据的职责进行“去中心化”的管理，会影响软件更新的管理。处理软件更新的常用方法，是当更新多个资源的时候，使用事务来保证一致性。这种方法经常在单块系统中被采用。</p>
<p>像这样使用事务，有助于保持数据一致性。但是在时域上会引发明显的耦合，这样一来，在多个服务之间处理事务时会出现一致性问题。分布式事务实现难度之大是不必多言的。为此，微服务架构更强调在各个服务之间进行<a
target="_blank" rel="noopener" href="http://www.enterpriseintegrationpatterns.com/ramblings/18_starbucks.html">“无事务”的协调</a>。这源自微服务社区明确地认识到下述两点，即数据一致性可能只要求数据在最终达到一致，并且一致性问题能够通过补偿操作来进行处理。</p>
<p>对于许多开发团队来说，选择这种方式来管理数据的“非一致性”，是一个新的挑战。但这通常也符合在商业上的实践做法。通常情况下，为了快速响应需求，商家们都会处理一定程度上的数据“非一致性”，通过做某种反向过程来进行错误处理。只要修复错误的成本低于“保持更大的数据一致性却导致丢了生意所产生”的成本相比，那么进行这种“非一致性”地数据管理就是值得的。</p>
<h4 id="特性七基础设施自动化">特性七：“基础设施”自动化</h4>
<p>基础设施自动化技术在过去几年里已经得到长足的发展。云的演进，特别是AWS的发展，已经降低了构建、部署和运维微服务的操作复杂性。</p>
<p>许多使用微服务构建的产品和系统，正在被这样的团队所构建，即他们都具备极其丰富的“<a
target="_blank" rel="noopener" href="http://martinfowler.com/bliki/ContinuousDelivery.html">持续交付</a>”和其前身“<a
target="_blank" rel="noopener" href="https://martinfowler.com/articles/continuousIntegration.html">持续集成</a>”的经验。用这种方法构建软件的各个团队，广泛采用了基础设施的自动化技术。如下图的构建流水线所示：</p>
<figure>
<img
src="http://insights.thoughtworks.cn/wp-content/uploads/2017/10/5-basic-build-pipeline-700x263.png"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>图5：基本的构建流水线</p>
<p>由于本文并不是一篇有关持续交付的文章，所以下面仅提请大家注意两个持续交付的关键特点。为了尽可能地获得对正在运行的软件的信心，需要运行大量的自动化测试。让可工作的软件达到“晋级”(Promotion)状态、从而“推上”流水线，就意味着可以在每一个新的环境中，对软件进行自动化部署。</p>
<p>一个单块应用程序，能够相当愉快地在上述各个环境中，被构建、测试和推送。其结果是，一旦在下述工作中进行了投入，即针对一个单块系统将其通往生产环境的通道进行自动化，那么部署更多的应用系统似乎就不再可怕。记住，持续交付的目的之一，是让“部署”工作变得“无聊”。所以不管是一个还是三个应用系统，只要部署工作依旧很“无聊”，那么就没什么可担心的了[12]。</p>
<blockquote>
<p><strong>让“沿着正确的方向做事”更容易</strong></p>
<p>那些因实现持续交付和持续集成所增加的自动化工作的副产品，是一些对开发和运维人员有用的工具。现在，能完成下述工作的工具已经相当常见了，即创建工件(artefacts)、管理代码库、启动一些简单的服务、或增加标准的监控和日志功能。Web上最好的例子可能是Netflix提供的一套<a
target="_blank" rel="noopener" href="http://netflix.github.io/">开源工具集</a>，但也有其他一些好工具，包括我们已经广泛使用的<a
target="_blank" rel="noopener" href="http://dropwizard.codahale.com/">Dropwizard</a>。</p>
</blockquote>
<p>我们所看到的各个团队在广泛使用基础设施自动化实践的另一个领域，是在生产环境中管理各个微服务。与前面我们对比单块系统和微服务所说的正相反，只要部署工作很无聊，那么在这一点上单块系统和微服务就没什么区别。然而，两者在运维领域的情况却截然不同。</p>
<figure>
<img
src="http://insights.thoughtworks.cn/wp-content/uploads/2017/10/6-Module_deployment_often_differs-700x408.jpg"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>图6：两者的模块部署经常会有差异</p>
<h4 id="特性八容错设计">特性八：“容错”设计</h4>
<p>使用各个微服务来替代组件，其结果是各个应用程序需要被设计的能够容忍这些服务所出现的故障。如果服务提供方不可用，那么任何对该服务的调用都会出现故障。客户端要尽可能优雅地应对这种情况。与一个单块设计相比，这是一个劣势。因为在处理这种情况时会引入额外的复杂性。为此，各个微服务团队在不断地反思：这些服务故障是如何影响用户体验的。Netflix公司所研发的开源测试工具<a
target="_blank" rel="noopener" href="https://github.com/Netflix/SimianArmy">Simian
Army</a>，能够诱导服务发生故障，甚至能诱导一个数据中心在工作日发生故障，来测试该应用的弹性和监控能力。</p>
<p>这种在生产环境中所进行的自动化测试，足以让大多数运维组织兴奋得浑身颤栗，就像即将迎来一周的长假那样。这并不是说单块架构风格不能构建先进的监控系统——只是根据我们的经验，这在单块系统中并不常见罢了。</p>
<blockquote>
<p><strong>"断路器"与“可随时上线的代码”</strong></p>
<p>“<a
target="_blank" rel="noopener" href="https://martinfowler.com/bliki/CircuitBreaker.html">断路器</a>”(Circuit
Breaker)一词与其他一些模式一起出现在《<a
target="_blank" rel="noopener" href="https://www.amazon.com/gp/product/B00A32NXZO?ie=UTF8&amp;tag=martinfowlerc-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=B00A32NXZO">Release
It!</a>》一书中，例如隔板(Bulkhead)和超时(Timeout)。当构建彼此通信的应用系统时，将这些模式加以综合运用就变得至关重要。Netflix公司的这篇<a
target="_blank" rel="noopener" href="http://techblog.netflix.com/2012/02/fault-tolerance-in-high-volume.html">很精彩的博客</a>解释了这些模式是如何应用的。</p>
</blockquote>
<p>因为各个服务可以在任何时候发生故障，所以下面两件事就变得很重要，即能够快速地检测出故障，而且在可能的情况下能够自动恢复服务。各个微服务的应用都将大量的精力放到了应用程序的实时监控上，来检查“架构元素指标”（例如数据库每秒收到多少请求）和“业务相关指标”（例如系统每分钟收到多少订单）。当系统某个地方出现问题，语义监控系统能提供一个预警，来触发开发团队进行后续的跟进和调查工作。</p>
<p>这对于一个微服务架构是尤其重要的，因为微服务对于服务编制(choreography)和<a
target="_blank" rel="noopener" href="https://martinfowler.com/eaaDev/EventCollaboration.html">事件协作</a>的偏好，会导致“突发行为”。尽管许多权威人士对于偶发事件的价值持积极态度，但事实上，“突发行为”有时是一件坏事。在能够快速发现有坏处的“突发行为”并进行修复方面，监控是至关重要的。</p>
<p>单块系统也能构建的像微服务一样来实现透明的监控系统——实际上，它们也应该如此。差别是，绝对需要知道那些运行在不同进程中的服务，在何时断掉了。而如果在同一个进程内使用软件库的话，这种透明的监控系统就用处不大了。</p>
<blockquote>
<p><strong>“同步调用”有害</strong></p>
<p>一旦在一些服务之间进行多个同步调用，就会遇到宕机的乘法效应。简而言之，这意味着整个系统的宕机时间，是每一个单独模块各自宕机时间的乘积。此时面临着一个选择：是让模块之间调用异步，还是去管理宕机时间？在<a
target="_blank" rel="noopener" href="https://www.theguardian.com/international">英国卫报网站</a>，他们在新平台上实现了一个简单的规则——每一个用户请求都对应一个同步调用。然而在Netflix公司，他们重新设计的平台API将异步性构建到API的机制(fabric)中。</p>
</blockquote>
<p>那些微服务团队希望在每一个单独的服务中，都能看到先进的监控和日志记录装置。例如显示“运行/宕机”状态的仪表盘，和各种运维、业务相关的指标。另外我们经常在工作中会碰到这样一些细节，即断路器的状态、当前的吞吐率和延迟，以及其他一些例子。</p>
<h4 id="特性九演进式设计">特性九：“演进式”设计</h4>
<p>那些微服务的从业者们，通常具有演进式设计的背景，而且通常将服务的分解，视作一个额外的工具，来让应用开发人员能够控制应用系统中的变化，而无须减少变化的发生。控制变化并不一定意味着要减少变化——在正确的态度和工具的帮助下，软件中的变化也可以发生得频繁、快速且得到良好的控制。</p>
<p>每当要试图将软件系统分解为各个组件时，就会面临这样的决策，即如何进行切分——我们决定切分应用系统时应该遵循的原则是什么？一个组件的关键属性，是具有独立更换和升级的特点[13]——这意味着，需要寻找这些点，即想象着能否在其中一个点上重写该组件，而无须影响该组件的其他合作组件。事实上，许多做微服务的团队会更进一步，他们明确地预期许多服务将来会报废，而不是守着这些服务做长期演进。</p>
<p>英国卫报网站是一个好例子。原先该网站是一个以单块系统的方式来设计和构建的应用系统，然而它已经开始向微服务方向进行演进了。原先的单块系统依旧是该网站的核心，但是在添加新特性时他们愿意以构建一些微服务的方式来进行添加，而这些微服务会去调用原先那个单块系统的API。当开发那些本身就带有临时性特点的新特性时，这种方法就特别方便，例如开发报道一个体育赛事的专门页面。当使用一些快速的开发语言时，这样的网站页面就能被快速地整合起来。而一旦赛事结束，这样页面就可以被删除。在一个金融机构中，我们已经看到了一些相似的做法，即针对一个市场机会，一些新的服务可以被添加进来。然后在几个月甚至几周之后，这些新服务就作废了。</p>
<p>这种强调“可更换性”的特点，是模块化设计一般性原则的一个特例，通过“变化模式”(pattern
of
change)[14]来驱动模块化的实现。大家都愿意将那些能在同时发生变化的东西，放到同一个模块中。系统中那些很少发生变化的部分，应该被放到不同的服务中，以区别于那些正在经历大量变动(churn)的部分。当发现两个服务需要被同时、反复变更，就意味着它们两个需要被合并。</p>
<p>把一个个组件放入一个个服务中，提高了软件发布精细化的程度。对于一个单块系统，任何变化都需要做一次整个应用系统的全量构建和部署。然而，对于一个个微服务来说，只需要重新部署修改过的那些服务就够了。这能简化并加快发布过程。但缺点是：必须要考虑当一个服务发生变化时，依赖它并对其进行消费的其他服务将无法工作。传统的集成方法是使用版本化来解决这个问题。但在微服务世界中，大家更喜欢<a
target="_blank" rel="noopener" href="https://martinfowler.com/articles/enterpriseREST.html#versioning">将版本化作为最后万不得已的手段</a>来使用。我们可以通过下述方法来避免许多版本化的工作，即把各个服务设计得尽量能够容错，来应对其所依赖的服务所发生的变化。</p>
<h3 id="未来的方向是微服务吗">未来的方向是“微服务”吗？</h3>
<p>我们写这篇文章的主要目的，是解释有关微服务的主要思路和原则。在花了一点时间做了这件事后，我们清楚地认识到，微服务架构风格是一个重要的理念——在研发企业应用系统时，值得对它进行认真考虑。我们最近已经使用这种风格构建了一些系统，并且了解到其他一些团队也赞同并正在使用这种方法。</p>
<p>我们所了解到的那些在某种程度上可以被称作这种架构风格的实践先驱包括：亚马逊、Netflix、<a
target="_blank" rel="noopener" href="https://www.theguardian.com/international">英国卫报</a>、<a
target="_blank" rel="noopener" href="https://gds.blog.gov.uk/">英国政府数字化服务中心</a>、realestate.com.au、Forward和comparethemarket.com。2013年的技术大会圈子充满了各种各样的、正在转向可归类为微服务的公司案例——包括Travis
CI。另外还有大量的组织，它们长期以来一直在做着我们认为可以归类为微服务的产品，却从未使用过这个名字（这通常被标记为SOA——尽管正如我们所说，SOA会表现出各种自相矛盾的形式[15]）。</p>
<p>尽管有这些正面的经验，但这并不意味着我们确信微服务是软件架构未来的方向。尽管到目前为止，与单块应用系统相比，我们对于所经历过的微服务的评价是积极的，但是我们也意识到这样的事实，即能供我们做出完整判断的时间还不够长。</p>
<p>通常，架构决策所产生的真正效果，只有在该决策做出若干年后才能真正显现。我们已经看到由带着强烈的模块化愿望的优秀团队所做的一些项目，最终构建出一个单块架构，并在几年之内不断腐化。许多人认为，如果使用微服务就不大可能出现这种腐化，因为服务的边界是明确的，而且难以随意搞乱。然而，对于那些开发时间足够长的各种系统，除非我们已经见识得足够多，否则我们无法真正评价微服务架构是如何成熟的。</p>
<figure>
<img
src="http://insights.thoughtworks.cn/wp-content/uploads/2017/10/7-building-microservices.png"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>我们的同事Sam Newman花了2014年的大部分时间撰写了<a
target="_blank" rel="noopener" href="https://www.amazon.com/gp/product/1491950358?ie=UTF8&amp;tag=martinfowlerc-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1491950358">一本书</a>，来记述我们构建微服务的经验。如果想对这个话题进行更深入的了解，下一步就应该是阅读这本书。</p>
<p>有人觉得微服务或许很难成熟起来，这当然是有原因的。在组件化上所做的任何工作的成功度，取决于软件与组件的匹配程度。准确地搞清楚某个组件的边界位置应该出现在哪里，是一件困难的工作。演进式设计承认难以对边界进行正确定位，所以它将工作的重点放到了易于对边界进行重构之上。但是当各个组件成为各个进行远程通信的服务后，比起在单一进程内调用各个软件库，此时的重构就变得更加困难。跨越服务边界的代码移动就变得困难起来。接口的任何变化，都需要在其各个参与者之间进行协调。向后兼容的层次也需要被添加进来。测试也会变得更加复杂。</p>
<p>另一个问题是，如果这些组件不能干净利落地组合成一个系统，那么所做的一切工作，仅仅是将组件内的复杂性转移到组件之间的连接之上。这样做的后果，不仅仅是将复杂性搬了家，它还将复杂性转移到那些不再明确且难以控制的边界之上。在观察一个小型且简单的组件内部时，人们很容易觉得事情已经变得更好了，然而他们却忽视了服务之间杂乱的连接。</p>
<p>最后，还要考虑团队成员的技能水平。新技术往往会被技术更硬的团队所采用。对于技术更加过硬的团队而更有效的一项技术，不一定适用于技术略逊一筹的团队。我们已经看到大量这样的案例，那些技术略逊一筹的团队构建出了杂乱的单块架构。当这种杂乱发生到微服务身上时，会出现什么情况？这需要花时间来观察。一个糟糕的团队，总会构建一个糟糕的系统——在这种情况下，很难讲微服务究竟是减少了杂乱，还是让事情变得更糟。</p>
<p>我们听到一个合理的<a
target="_blank" rel="noopener" href="https://martinfowler.com/bliki/MonolithFirst.html">说法</a>：不要一上来就以微服务架构做为起点。相反，要用一个单块系统做为起点，并保持其模块化。当这个单块系统出现了问题后，再将其分解为微服务。（尽管这个<a
target="_blank" rel="noopener" href="https://martinfowler.com/articles/dont-start-monolith.html">建议</a>并不理想，因为一个良好的单一进程内的接口，通常不是一个良好的服务接口。）</p>
<p>因此，我们持谨慎乐观的态度来撰写此文。到目前为止，我们已经看到足够多的有关微服务风格的内容，并且觉得这是一条值得去跋涉的道路。我们不能肯定地说，道路的尽头在哪里。但是，软件开发的挑战之一，就是只能基于“目前手上拥有但还不够完善”的信息来做出决策。</p>
<p>若欲获取最新参考资料列表以得到更多信息，请参见<a
target="_blank" rel="noopener" href="http://martinfowler.com/microservices/">微服务资源指南：http://martinfowler.com/microservices/</a>。</p>
<p>注：</p>
<p>[1].
2011年5月在威尼斯附近的一个软件架构工作坊中，大家开始讨论“微服务”这个术语，因为这个词可以描述参会者们在架构领域进行探索时所见到的一种通用的架构风格。2012年5月，这群参会者决定将“微服务”作为描述这种架构风格的最贴切的名字。在2012年3月波兰的克拉科夫市举办的“33rd
Degree”技术大会上，本文作者之一James在其“<a
target="_blank" rel="noopener" href="http://2012.33degree.org/talk/show/67">Microservices - Java, the
Unix Way</a>”演讲中以案例的形式谈到了这些微服务的观点，与此同时，<a
target="_blank" rel="noopener" href="http://www.slideshare.net/fredgeorge/micro-service-architecure">Fred
George</a>也表达了同样的观点。Netflix公司的Adrian
Cockcroft将这种方法描述为“细粒度的SOA”，并且作为先行者和本文下面所提到的众人已经着手在Web领域进行了实践——Joe
Walnes, Dan North, Evan Botcher 和 Graham Tackley。</p>
<p>[2].
"单块"(monolith)这个术语已经被Unix社区使用一段时间了。它出现在The Art of
Unix Programming一书中，来描述那些变得庞大的系统。</p>
<p>[3]. 许多面向对象的设计者，包括我们自己，都使用领域驱动设计中“service
object”这个术语，来描述那种执行一段未被绑定到一个entity对象上的重要逻辑过程的对象。这不同于本文所讨论的"service"的概念。可悲的是，service这个术语同时具有这两个含义，我们必须忍受这样的多义词。</p>
<p>[4].
我们认为一个应用系统是一个社会性的构建单元，来将一个代码库、功能组和资金体（body
of funding）结合起来。</p>
<p>[5].
原始论文参见梅尔文•康威的网站：http://www.melconway.com/Home/Committees_Paper.html</p>
<p>[6].
在极度强调高效性(Scale)的情况下，一些组织经常会使用一些二进制的消息发送协议——例如protobuf。即使是这样，这些系统仍然会呈现出“智能端点和傻瓜管道”的特点——来在易读性(transparency)与高效性之间取得平衡。当然，大多数Web属性和绝大多数企业并不需要作出这样的权衡——获得易读性就已经是一个很大的胜利了。</p>
<p>[7]. 忍不住要提一下Jim Webber的说法：ESB表示Egregious Spaghetti
Box（一盒极烂的意大利面条）。</p>
<p>[8].
Netflix让SOA与微服务之间的联系更加明确——直到最近这家公司还将他们的架构风格称为“细粒度的SOA”。</p>
<p>[9]. "YAGNI" 或者 "You Aren't Going To Need
It"（你不会需要它）是极限编程的一条原则和劝诫，指的是“除非到了需要的时候，否则不要添加新功能”。</p>
<p>[10].
单块系统使用单一编程语言，这样讲有点言不由衷——为了在今天的Web上构建各种系统，可能要了解JavaScript、XHTML、CSS、服务器端的编程语言、SQL和一种ORM的方言。很难说只有一种单一编程语言，但是我们的意思你是懂得的。</p>
<p>[11]. Adrian
Cockcroft在他2013年11月于Flowcon技术大会所做的一次精彩的演讲中，特别提到了“开发人员自服务”和“开发人员运行他们写的东西”（原文如此）。</p>
<p>[12]. 这里我们又有点言不由衷了。
很明显，在更复杂的网络拓扑里，部署更多的服务，会比部署一个单独的单块系统要更加困难。幸运的是，有一些模式能够减少其中的复杂性——但对于工具的投资还是必须的。</p>
<p>[13]. 事实上，Dan
North将这种架构风格称作“可更换的组件架构”，而不是微服务。因为这看起来似乎是在谈微服务特性的一个子集，所以我们选择将其归类为微服务。</p>
<p>[14]. Kent Beck在《实现模式》(Implementation
Patterns)一书中，将其作为他的一条设计原则而强调出来。</p>
<p>[15].
当SOA这个词在本世纪初刚刚出现时，有人曾说：“我们很多年以来一直是这样做的。”有一派观点说，SOA这种风格，将企业级计算早期COBOL程序通过数据文件来进行通信的方式，视作自己的“根”。在另一个方向上，有人说“Erlang编程模型”与微服务是同一回事，只不过它被应用到一个企业应用的上下文中去了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://twoandone.github.io/2021/03/02/Morris%20%E4%B8%AD%E5%BA%8F%E9%81%8D%E5%8E%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Yus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yussss">
      <meta itemprop="description" content="后端废物">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Yussss">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/02/Morris%20%E4%B8%AD%E5%BA%8F%E9%81%8D%E5%8E%86/" class="post-title-link" itemprop="url">Morris 中序遍历</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-02 13:42:25" itemprop="dateCreated datePublished" datetime="2021-03-02T13:42:25+08:00">2021-03-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-18 01:32:58" itemprop="dateModified" datetime="2022-07-18T01:32:58+08:00">2022-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>二叉树的中序遍历，空间复杂度O(1)的算法</p>
<p><strong>思路</strong></p>
<p>关键：用一个节点记住根节点的前驱节点</p>
<p>如何找到这个根节点的前驱节点呢？</p>
<ol type="1">
<li>如果根节点有左子树，那么前驱节点就是左子树的最右的叶子节点</li>
<li>如果根节点没有左子树，那么就不用管，直接把root.val加入返回数组，然后继续判断右子树</li>
</ol>
<p>前驱节点有什么用？</p>
<p>前驱节点可以用于连接当左子树遍历之后需要继续遍历右子树的情况</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">predecessor</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(root != <span class="literal">null</span>)&#123; <span class="comment">// root 的值就是需要加入返回数组的值，当root不等于null就说明还需要再遍历</span></span><br><span class="line">            <span class="keyword">if</span>(root.left != <span class="literal">null</span> &amp;&amp; root.left != predecessor)&#123; <span class="comment">// 如果有左子树并且左子树没有被遍历过</span></span><br><span class="line">                predecessor = root.left;</span><br><span class="line">                <span class="keyword">while</span>(predecessor.right != <span class="literal">null</span>)&#123;</span><br><span class="line">                    predecessor = predecessor.right; <span class="comment">// 找到前驱节点</span></span><br><span class="line">                &#125;</span><br><span class="line">                predecessor.right = root; <span class="comment">// 创建连接</span></span><br><span class="line">                root = root.left; <span class="comment">// 因为这里所以要创建连接</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果没有左子树</span></span><br><span class="line">                res.add(root.val); </span><br><span class="line">                root = root.right; <span class="comment">// 遍历右子树</span></span><br><span class="line">                <span class="keyword">if</span>(predecessor != <span class="literal">null</span>) <span class="comment">// 对遍历结束的子树断开连接，保证结构不改变</span></span><br><span class="line">                    predecessor.right = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>给定一个二叉树的根节点 root ，返回它的 中序遍历。</p>
<p>示例 1：</p>
<p>输入：root = [1,null,2,3]</p>
<p>输出：[1,3,2]</p>
<figure>
<img src="https://assets.leetcode.com/uploads/2020/09/15/inorder_1.jpg"
alt="图一" />
<figcaption aria-hidden="true">图一</figcaption>
</figure>
<p>示例 2：</p>
<p>输入：root = []</p>
<p>输出：[]</p>
<p>示例 3：</p>
<p>输入：root = [1]</p>
<p>输出：[1]</p>
<p>示例 4：</p>
<figure>
<img src="https://assets.leetcode.com/uploads/2020/09/15/inorder_5.jpg"
alt="图二" />
<figcaption aria-hidden="true">图二</figcaption>
</figure>
<p>输入：root = [1,2]</p>
<p>输出：[2,1]</p>
<p>示例 5：</p>
<p>输入：root = [1,null,2]</p>
<p>输出：[1,2]</p>
<p>提示：</p>
<p>树中节点数目在范围 [0, 100] 内 -100 &lt;= Node.val &lt;= 100</p>
<p>https://leetcode-cn.com/problems/binary-tree-inorder-traversal/</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://twoandone.github.io/2021/02/26/Typora-PicGo-Gitee-%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E5%BF%AB%E9%80%9F%E4%B8%8A%E4%BC%A0-%E5%9B%BE%E5%BA%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Yus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yussss">
      <meta itemprop="description" content="后端废物">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Yussss">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/02/26/Typora-PicGo-Gitee-%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E5%BF%AB%E9%80%9F%E4%B8%8A%E4%BC%A0-%E5%9B%BE%E5%BA%8A/" class="post-title-link" itemprop="url">Typora+PicGo+Gitee 实现图片快速上传 图床</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-02-26 16:19:51" itemprop="dateCreated datePublished" datetime="2021-02-26T16:19:51+08:00">2021-02-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-18 00:54:22" itemprop="dateModified" datetime="2022-07-18T00:54:22+08:00">2022-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol type="1">
<li><p>下载 <a target="_blank" rel="noopener" href="https://typora.io/#windows">Typora</a></p></li>
<li><p>下载 <a target="_blank" rel="noopener" href="https://molunerfinn.com/PicGo/">PicGo</a></p></li>
<li><p>注册 <a target="_blank" rel="noopener" href="https://gitee.com/">Gitee</a></p></li>
<li><p>创建仓库</p>
<figure>
<img
src="https://github.com/TwoAndOne/my-images/raw/master/img/image-20210226163520859.png"
alt="image-20210226163520859" />
<figcaption aria-hidden="true">image-20210226163520859</figcaption>
</figure></li>
<li><p>创建文件夹image</p></li>
<li><p>创建私人令牌（设置-&gt;私人令牌-&gt;新建私人令牌）</p>
<figure>
<img src="/Users/yus/workspace/i/iEssay/image-20210226163730024.png"
alt="image-20210226163730024" />
<figcaption aria-hidden="true">image-20210226163730024</figcaption>
</figure></li>
<li><p>打开PicGo，插件设置，搜索<code>Gitee</code></p>
<figure>
<img
src="https://github.com/TwoAndOne/my-images/raw/master/img/image-20210226163822038.png"
alt="image-20210226163822038" />
<figcaption aria-hidden="true">image-20210226163822038</figcaption>
</figure></li>
<li><p>安装后点击，左边gitee</p>
<figure>
<img
src="https://github.com/TwoAndOne/my-images/raw/master/img/image-20210226164148955.png"
alt="image-20210226164148955" />
<figcaption aria-hidden="true">image-20210226164148955</figcaption>
</figure></li>
<li><p>打开Typora图像设置</p>
<figure>
<img
src="https://github.com/TwoAndOne/my-images/raw/master/img/image-20210226164541246.png"
alt="image-20210226164541246" />
<figcaption aria-hidden="true">image-20210226164541246</figcaption>
</figure></li>
<li><p>点击验证图片上传选项，验证</p></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://twoandone.github.io/2021/02/10/Spring%20Note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Yus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yussss">
      <meta itemprop="description" content="后端废物">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Yussss">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/02/10/Spring%20Note/" class="post-title-link" itemprop="url">Spring Note</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-02-10 19:47:00" itemprop="dateCreated datePublished" datetime="2021-02-10T19:47:00+08:00">2021-02-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-08-03 16:28:05" itemprop="dateModified" datetime="2022-08-03T16:28:05+08:00">2022-08-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最基础的架构</p>
<p>BeanFactory
里面是一个map，k对应bean的名字，v对应bean的定义，bean从beanDefinition中获取。</p>
<h2 id="设计和实现资源加载器从spring.xml解析和注册bean对象">6
设计和实现资源加载器，从Spring.xml解析和注册Bean对象</h2>
<blockquote>
<p>承接需求并能把它做好，这来自于对需求的理解，产品场景开发的经验以及对代码实践落地的把控能力等综合多方面因素的结果。就像你现在做的开发中，你的代码有哪些是经常变化的，有哪些是固定通用的，有哪些是负责逻辑拼装的、有哪些是来做核心实现的。那么现在如果你的核心共用层做了频繁变化的业务层包装，那么肯定的说，你的代码即将越来越乱，甚至可能埋下事故的风险！</p>
</blockquote>
<h3 id="设计">6.1 设计</h3>
<p>为了更好的解耦也方便用户操作，需要添加一个资源解析器，也就是能够读取classpath、本地文件、云文件的配置内容。内容会包括Bean对象的描述和属性信息。</p>
<p>读取之后，需要对配置文件里的Bean描述信息进行解析后注册到容器里。</p>
<ul>
<li>资源加载器属于相对独立的部分，位于Spring框架核心包下的IO实现内容，主要用于处理Class、本地和云环境中的文件信息。</li>
<li>当资源可以加载后，接下来就是解析和注册Bean到Spring中的操作，这部分的实现需要和<code>DefaultLIstableBeanFactory</code>核心类结合起来，因为所有解析后的注册动作，都会把Bean定义信息放到这个类中。</li>
<li>所以我们需要定义出Bean定义的读取接口：<code>BeanDefinitionReader</code>以及做好对应的实现类，在实现类中完成对Bean对象的解析和注册。</li>
</ul>
<p><img
src="https://bugstack.cn/assets/images/spring/spring-6-02.png" /></p>
<blockquote>
<p>接口管定义，抽象类处理非接口功能外的注册Bean组件填充，最终实现类即可只关心具体的业务实现</p>
<ul>
<li>这里需要注意
getRegistry()、getResourceLoader()，都是用于提供给后面三个方法的工具，加载和注册，这两个方法的实现会包装到抽象类中，以免污染具体的接口实现方法。</li>
</ul>
</blockquote>
<hr />
<p>2021-02-10 19:47:00</p>
<h1 id="spring-overview">Spring Overview</h1>
<h2 id="简介">简介</h2>
<p>Spring : 春天 ---&gt;给软件行业带来了春天</p>
<p>2002年，Rod Jahnson首次推出了Spring框架雏形interface21框架。</p>
<p>2004年3月24日，Spring框架以interface21框架为基础，经过重新设计，发布了1.0正式版。</p>
<p>很难想象Rod Johnson的学历 ,
他是悉尼大学的博士，然而他的专业不是计算机，而是音乐学。</p>
<p>Spring理念 : 使现有技术更加实用 . 本身就是一个大杂烩 ,
整合现有的框架技术。</p>
<ul>
<li>SSH：Struct2+Spring+Hibernate</li>
<li>SSM：SpringMVC+Spring+Mybatis</li>
</ul>
<h2 id="优点">优点</h2>
<ol type="1">
<li><p>Spring是一个开源免费的框架 , 容器 .</p></li>
<li><p>Spring是一个轻量级的框架 , 非侵入式的</p></li>
<li><p><strong>控制反转 IoC , 面向切面 Aop</strong></p></li>
<li><p>对事物的支持 , 对框架的支持</p></li>
</ol>
<h2 id="组成">组成</h2>
<figure>
<img
src="https://upload-images.jianshu.io/upload_images/788498-358a3764fcbca0e4.png?imageMogr2/auto-orient/strip"
alt="Spring概述" />
<figcaption aria-hidden="true">Spring概述</figcaption>
</figure>
<p>Spring 框架是一个分层架构，由 7 个定义良好的模块组成。Spring
模块构建在核心容器之上，核心容器定义了创建、配置和管理 bean 的方式</p>
<p>组成 Spring
框架的每个模块（或组件）都可以单独存在，或者与其他一个或多个模块联合实现。每个模块的功能如下：</p>
<ul>
<li><strong>核心容器</strong>：核心容器提供 Spring
框架的基本功能。核心容器的主要组件是
BeanFactory，它是工厂模式的实现。BeanFactory
使用<em>控制反转</em>（IOC）
模式将应用程序的配置和依赖性规范与实际的应用程序代码分开。</li>
<li><strong>Spring 上下文</strong>：Spring 上下文是一个配置文件，向
Spring 框架提供上下文信息。Spring 上下文包括企业服务，例如
JNDI、EJB、电子邮件、国际化、校验和调度功能。</li>
<li><strong>Spring AOP</strong>：通过配置管理特性，Spring AOP
模块直接将面向切面的编程功能 , 集成到了 Spring
框架中。所以，可以很容易地使 Spring 框架管理任何支持 AOP的对象。Spring
AOP 模块为基于 Spring 的应用程序中的对象提供了事务管理服务。通过使用
Spring AOP，不用依赖组件，就可以将声明性事务管理集成到应用程序中。</li>
<li><strong>Spring DAO</strong>：JDBC DAO
抽象层提供了有意义的异常层次结构，可用该结构来管理异常处理和不同数据库供应商抛出的错误消息。异常层次结构简化了错误处理，并且极大地降低了需要编写的异常代码数量（例如打开和关闭连接）。Spring
DAO 的面向 JDBC 的异常遵从通用的 DAO 异常层次结构。</li>
<li><strong>Spring ORM</strong>：Spring 框架插入了若干个 ORM
框架，从而提供了 ORM 的对象关系工具，其中包括 JDO、Hibernate 和 iBatis
SQL Map。所有这些都遵从 Spring 的通用事务和 DAO 异常层次结构。</li>
<li><strong>Spring Web 模块</strong>：Web
上下文模块建立在应用程序上下文模块之上，为基于 Web
的应用程序提供了上下文。所以，Spring 框架支持与 Jakarta Struts
的集成。Web
模块还简化了处理多部分请求以及将请求参数绑定到域对象的工作。</li>
<li><strong>Spring MVC 框架</strong>：MVC 框架是一个全功能的构建 Web
应用程序的 MVC 实现。通过策略接口，MVC 框架变成为高度可配置的，MVC
容纳了大量视图技术，其中包括 JSP、Velocity、Tiles、iText 和 POI。</li>
</ul>
<h2 id="拓展">拓展</h2>
<p><strong>Spring Boot与Spring Cloud</strong></p>
<ul>
<li>Spring Boot 是 Spring 的一套快速配置脚手架，可以基于Spring Boot
快速开发单个微服务;</li>
<li>Spring Cloud是基于Spring Boot实现的；</li>
<li>Spring Boot专注于快速、方便集成的单个微服务个体，Spring
Cloud关注全局的服务治理框架；</li>
<li>Spring
Boot使用了约束优于配置的理念，很多集成方案已经帮你选择好了，能不配置就不配置
, Spring Cloud很大的一部分是基于Spring Boot来实现，Spring
Boot可以离开Spring Cloud独立使用开发项目，但是Spring Cloud离不开Spring
Boot，属于依赖的关系。</li>
<li>SpringBoot在SpringClound中起到了承上启下的作用，如果你要学习SpringCloud必须要学习SpringBoot。</li>
</ul>
<h1 id="ioc理论推导">IOC理论推导</h1>
<h2 id="环境配置">环境配置</h2>
<ol type="1">
<li><p>创建Maven项目，删除src文件夹</p></li>
<li><p>在父pom.xml下添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>新建一个空白maven子模块myspring-01</p></li>
</ol>
<h2 id="ioc本质">IoC本质</h2>
<p><strong>控制反转IoC（Inversion of
Control），是一种设计思想，DI（依赖注入）是实现IoC的一种方法。</strong></p>
<p>也有人说DI只是IoC的另一种说法。没有IoC的程序中，我们使用面向对象编程，对象的创建与对象间的依赖关系完全硬编码在程序中，对象的创建由程序自己控制，控制反转后讲对象的创建转移给第三方，个人认为所谓控制反转就是：获得依赖对象的方式反转了。</p>
<figure>
<img
src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7KtDiaOqFy5ourlJ8FTVV2FFuYibmavlBHq9e4cDqiclpYSG8VT4EicVsnqKp65yJKQeNibsVdTiahQibJSg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"
alt="IOC" />
<figcaption aria-hidden="true">IOC</figcaption>
</figure>
<p>IoC是Spring框架的核心内容，使用多种方式完美的实现了IoC，可以使用XML配置、也可以使用注解、新版本的Spring也可以零配置实现IoC。</p>
<p>Spring容器在初始化时先读取配置文件，根据配置文件或元数据创建</p>
<h1 id="代理模式">代理模式</h1>
<p>AOP的底层机制就是动态代理</p>
<p>代理模式：</p>
<pre><code>1. 静态代理
2. 动态代理</code></pre>
<figure>
<img
src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7LoeicP1O2nfyA6H0XPa9jMLRnfS7LpO0Iic7fEEPFCgRs0ggNXCwf6IKo1tibjPmNSTEYeII5ro7YLQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"
alt="proxy" />
<figcaption aria-hidden="true">proxy</figcaption>
</figure>
<h2 id="静态代理">静态代理</h2>
<p>静态代理角色分析：</p>
<ul>
<li>抽象角色：一般使用接口或者抽象类来实现</li>
<li>真实角色：被代理的角色</li>
<li>代理角色：代理真实角色；代理真实角色后，一般会左一些附属的操作</li>
<li>客户：使用代理角色来进行一些操作</li>
</ul>
<p><strong>代码实现</strong> E:\20200128-proxy</p>
<p>Rent . java 即抽象角色</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//抽象角色：租房</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Rent</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Host . java 即真实角色</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//真实角色: 房东，房东要出租房子</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Host</span> <span class="keyword">implements</span> <span class="title class_">Rent</span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span> &#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;房屋出租&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Proxy . java 即代理角色</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代理角色：中介</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Proxy</span> <span class="keyword">implements</span> <span class="title class_">Rent</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Host host;</span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">Proxy</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">Proxy</span><span class="params">(Host host)</span> &#123;</span><br><span class="line">       <span class="built_in">this</span>.host = host;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//租房</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span>&#123;</span><br><span class="line">       seeHouse();</span><br><span class="line">       host.rent();</span><br><span class="line">       fare();</span><br><span class="line">  &#125;</span><br><span class="line">   <span class="comment">//看房</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">seeHouse</span><span class="params">()</span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;带房客看房&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">   <span class="comment">//收中介费</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fare</span><span class="params">()</span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;收中介费&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Client . java 即客户</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//客户类，一般客户都会去找代理！</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">//房东要租房</span></span><br><span class="line">       <span class="type">Host</span> <span class="variable">host</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Host</span>();</span><br><span class="line">       <span class="comment">//中介帮助房东</span></span><br><span class="line">       <span class="type">Proxy</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(host);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//你去找中介！</span></span><br><span class="line">       proxy.rent();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析：在这个过程中，你直接接触的就是中介，就如同现实生活中的样子，你看不到房东，但是你依旧租到了房东的房子通过代理，这就是所谓的代理模式，程序源自于生活，所以学编程的人，一般能够更加抽象的看待生活中发生的事情。</p>
<h3 id="优点-1">优点</h3>
<ul>
<li>可以使真实角色更加纯粹，不再去关注一些公共的事情</li>
<li>公共的业务由代理来完成，实现了业务的分工</li>
<li>公共业务发生扩展时变得更加集中和方便</li>
</ul>
<h3 id="缺点">缺点</h3>
<ul>
<li>类多了，代理类也会变多，工作量变大，效率变低</li>
</ul>
<p>如果要克服静态代理的缺点，诞生了动态代理</p>
<h3 id="深入理解">深入理解</h3>
<p>E:\20200128-proxy</p>
<p>练习步骤：</p>
<p>1、创建一个抽象角色，比如咋们平时做的用户业务，抽象起来就是增删改查！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//抽象角色：增删改查业务</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>;</span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span>;</span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">query</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、我们需要一个真实对象来完成这些增删改查操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//真实对象，完成增删改查操作的人</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span> &#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;增加了一个用户&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span> &#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;删除了一个用户&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;更新了一个用户&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">query</span><span class="params">()</span> &#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;查询了一个用户&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、需求来了，现在我们需要增加一个日志功能，怎么实现！</p>
<ul>
<li>思路1 ：在实现类上增加代码 【麻烦！】</li>
<li>思路2：使用代理来做，能够不改变原来的业务情况下，实现此功能就是最好的了！</li>
</ul>
<p>4、设置一个代理类来处理日志！代理角色</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代理角色，在这里面增加日志的实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceProxy</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> UserServiceImpl userService;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserService</span><span class="params">(UserServiceImpl userService)</span> &#123;</span><br><span class="line">       <span class="built_in">this</span>.userService = userService;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span> &#123;</span><br><span class="line">       log(<span class="string">&quot;add&quot;</span>);</span><br><span class="line">       userService.add();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span> &#123;</span><br><span class="line">       log(<span class="string">&quot;delete&quot;</span>);</span><br><span class="line">       userService.delete();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">       log(<span class="string">&quot;update&quot;</span>);</span><br><span class="line">       userService.update();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">query</span><span class="params">()</span> &#123;</span><br><span class="line">       log(<span class="string">&quot;query&quot;</span>);</span><br><span class="line">       userService.query();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;执行了&quot;</span>+msg+<span class="string">&quot;方法&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5、测试访问类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">//真实业务</span></span><br><span class="line">       <span class="type">UserServiceImpl</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">       <span class="comment">//代理类</span></span><br><span class="line">       <span class="type">UserServiceProxy</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceProxy</span>();</span><br><span class="line">       <span class="comment">//使用代理类实现日志功能！</span></span><br><span class="line">       proxy.setUserService(userService);</span><br><span class="line"></span><br><span class="line">       proxy.add();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>OK，到了现在代理模式大家应该都没有什么问题了，重点大家需要理解其中的思想；</p>
<p>我们在不改变原来的代码的情况下，实现了对原有功能的增强，这是AOP中最核心的思想</p>
<p>聊聊AOP：纵向开发，横向开发</p>
<figure>
<img
src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7LoeicP1O2nfyA6H0XPa9jMLJqcgicA5aEKtxYibgLPicNfDwicKIn9NlFl86rriaVRicKnEXlPNiacbHiaLibw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"
alt="AOP" />
<figcaption aria-hidden="true">AOP</figcaption>
</figure>
<h2 id="动态代理">动态代理</h2>
<ul>
<li>动态代理的角色与静态代理一致</li>
<li>动态代理的代理类是动态生成的，静态代理的类是我们提前写好的</li>
<li>动态代理分为两类：
<ul>
<li>基于接口的动态代理
<ul>
<li>JDK动态代理</li>
</ul></li>
<li>基于类的动态代理
<ul>
<li>cglib</li>
</ul></li>
<li>基于字节码的动态代理
<ul>
<li>javasist</li>
</ul></li>
</ul></li>
</ul>
<p>动态代理需要了解两个类</p>
<ul>
<li>InvocationHandler</li>
<li>Proxy</li>
</ul>
<h3 id="invocationhandler">InvocationHandler</h3>
<p>Module java.base 软件包 java.lang.reflect</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Interface  InvocationHandler</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">InvocationHandler</span></span><br></pre></td></tr></table></figure>
<p><code>InvocationHandler</code>是由代理实例的<em>调用处理程序</em>实现的接口。每个代理实例都有一个关联的调用处理程序。
当在代理实例上调用方法时，方法调用将被编码并分派到其调用处理程序的<code>invoke</code>方法。</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Object <span class="title function_">invoke</span><span class="params">(Object proxy,</span></span><br><span class="line"><span class="params">			Method method,</span></span><br><span class="line"><span class="params">			Object[] args)</span><span class="keyword">throws</span> Throwable</span><br></pre></td></tr></table></figure> 处理代理实例上的方法调用并返回结果。
当在与之关联的代理实例上调用方法时，将在调用处理程序中调用此方法。</p>
<ul>
<li><code>proxy</code> - 调用该方法的代理实例</li>
<li><code>method</code> -
对应于在代理实例上调用的接口方法的<code>方法</code>实例。
<code>方法</code>对象的声明类将是方法声明的接口，它可以是代理类继承方法的代理接口的超级接口。</li>
<li><code>args</code> -
包含代理实例上方法调用中传递的参数值的对象数组，如果接口方法不带参数，
<code>null</code> 。
原始类型的参数包含在适当的原始包装器类的实例中，例如<code>java.lang.Integer</code>或<code>java.lang.Boolean</code>
。</li>
</ul>
<h3 id="proxy">Proxy</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Proxy</span> </span><br><span class="line">    <span class="keyword">extends</span> <span class="title class_">Object</span> </span><br><span class="line">    <span class="keyword">implements</span> <span class="title class_">Serializable</span></span><br></pre></td></tr></table></figure>
<p><code>Proxy</code>
提供了静态方法来创建类似于接口实列的对象，但允许自定义的方法调用。</p>
<p>代理类是在允许时创建的实现指定的接口列表的类。</p>
<p>代理实例是代理类的一个实例。每个代理实例都有一个关联的调用处理程序对象，它实现接口<code>InvocationHandler</code>。</p>
<p>通过其代理接口之一的代理实例上的方法调用将被分派到实例调用处理程序的<a
href="../../../java/lang/reflect/InvocationHandler.html#invoke-java.lang.Object-java.lang.reflect.Method-java.lang.Object:A-"><code>invoke</code></a>方法，传递代理实例，标识调用方法的<code>java.lang.reflect.Method</code>对象以及包含参数的类型为<code>Object</code>的数组。
调用处理程序适当地处理编码方法调用，并且返回的结果将作为方法在代理实例上调用的结果返回。</p>
<p>在运行期动态创建一个<code>interface</code>实例的方法如下：</p>
<ol type="1">
<li><p>定义一个<code>InvocationHandler</code>实例，它负责实现接口的方法调用；</p></li>
<li><p>通过<code>Proxy.newProxyInstance()</code></p>
<p>创建<code>interface</code></p>
<p>实例，它需要3个参数：</p>
<ol type="1">
<li>使用的<code>ClassLoader</code>，通常就是接口类的<code>ClassLoader</code>；</li>
<li>需要实现的接口数组，至少需要传入一个接口进去；</li>
<li>用来处理接口方法调用的<code>InvocationHandler</code>实例。</li>
</ol></li>
<li><p>将返回的<code>Object</code>强制转型为接口。</p></li>
</ol>
<p>动态代理实际上是JVM在运行期动态创建class字节码并加载的过程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//生成代理类</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">getProxy</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> Proxy.newProxyInstance(<span class="built_in">this</span>.getClass().getClassLoader(),</span><br><span class="line">                                 rent.getClass().getInterfaces(),<span class="built_in">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>代码实现</strong></p>
<p>抽象角色和真实角色和之前的一样！</p>
<p>Rent . java 即抽象角色</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//抽象角色：租房</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Rent</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Host . java 即真实角色</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//真实角色: 房东，房东要出租房子</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Host</span> <span class="keyword">implements</span> <span class="title class_">Rent</span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span> &#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;房屋出租&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ProxyInvocationHandler. java 即代理角色</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> Rent rent;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRent</span><span class="params">(Rent rent)</span> &#123;</span><br><span class="line">       <span class="built_in">this</span>.rent = rent;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//生成代理类，重点是第二个参数，获取要代理的抽象角色！之前都是一个角色，现在可以代理一类角色</span></span><br><span class="line">   <span class="keyword">public</span> Object <span class="title function_">getProxy</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="keyword">return</span> Proxy.newProxyInstance(<span class="built_in">this</span>.getClass().getClassLoader(),</span><br><span class="line">               rent.getClass().getInterfaces(),<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// proxy : 代理类 method : 代理类的调用处理程序的方法对象.</span></span><br><span class="line">   <span class="comment">// 处理代理实例上的方法调用并返回结果</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">       seeHouse();</span><br><span class="line">       <span class="comment">//核心：本质利用反射实现！</span></span><br><span class="line">       <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(rent, args);</span><br><span class="line">       fare();</span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//看房</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">seeHouse</span><span class="params">()</span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;带房客看房&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">   <span class="comment">//收中介费</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fare</span><span class="params">()</span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;收中介费&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Client . java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//租客</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">//真实角色</span></span><br><span class="line">       <span class="type">Host</span> <span class="variable">host</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Host</span>();</span><br><span class="line">       <span class="comment">//代理实例的调用处理程序</span></span><br><span class="line">       <span class="type">ProxyInvocationHandler</span> <span class="variable">pih</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProxyInvocationHandler</span>();</span><br><span class="line">       pih.setRent(host); <span class="comment">//将真实角色放置进去！</span></span><br><span class="line">       <span class="type">Rent</span> <span class="variable">proxy</span> <span class="operator">=</span> (Rent)pih.getProxy(); <span class="comment">//动态生成对应的代理类！</span></span><br><span class="line">       proxy.rent();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>核心：<strong>一个动态代理 , 一般代理某一类业务 ,
一个动态代理可以代理多个类，代理的是接口！、</strong></p>
<h3 id="优点-2">优点</h3>
<p>静态代理有的它有，没有的它也有。</p>
<ul>
<li>可以使得我们的真实角色更加纯粹 . 不再去关注一些公共的事情 .</li>
<li>公共的业务由代理来完成 . 实现了业务的分工 ,</li>
<li>公共业务发生扩展时变得更加集中和方便 .</li>
<li>一个动态代理 , 一般代理某一类业务</li>
<li>一个动态代理可以代理多个类，代理的是接口！</li>
</ul>
<h1 id="aop">AOP</h1>
<p>Aspect Oriented
Programming：面向切面编程，通过预编译方式和云更新期间动态代理实现程序功能的统一维护的一种技术。</p>
<p>AOP是OOP的延续，是软件开发的一个热点，也是Spring框架的一个重要内容，是函数式编程的一种衍生范型。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各个部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。</p>
<figure>
<img
src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7JAeTYOaaH6rZ6WmLLgwQLHf5pmH30gj6mZm81PC7iauicFu55sicJtspU7K3vTCVdZCDTSHq7D5XHlw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"
alt="AOP" />
<figcaption aria-hidden="true">AOP</figcaption>
</figure>
<h2 id="aop-在声明式事务中的作用">AOP 在声明式事务中的作用</h2>
<ul>
<li>横切关注点：跨越应用程序多个模块的方法或功能。即，与我们业务逻辑无关的，但是需要我们关注的部分，如：日志、安全、缓存、事务......</li>
<li>切面aspect：横切关注点被模块化的特殊对象。即，它是一个类。如：<strong>日志类</strong></li>
<li>目标target：被通知的对象。<strong>业务逻辑类</strong></li>
<li>代理proxy：向目标对象应用通知之后创建的对象。<strong>代理类</strong></li>
<li>连接点joint
point：与切入点匹配的执行点。<strong>类里面哪些方法可以被增强，这些方法称为连接点</strong></li>
<li>切入点point
cut：切面通知执行的地点的定义。<strong>实际被真正增强的方法，成为切入点</strong></li>
<li>通知advice：切面必须完成的工作，即，它是类中的一个方法。<strong>实际增强的逻辑部分称为通知（增强）</strong></li>
</ul>
<p>SpringAOP中，通过advice定义横切逻辑，Spring中支持5种类型的advice：</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 25%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="header">
<th>通知类型</th>
<th>连接点</th>
<th>实现接口</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>前置通知</td>
<td>方法前</td>
<td>org.springframework.aop.MethodBeforeAdvice</td>
</tr>
<tr class="even">
<td>后置通知</td>
<td>方法后</td>
<td>org.springframework.aop.AfterReturningAdvice</td>
</tr>
<tr class="odd">
<td>环绕通知</td>
<td>方法前后</td>
<td>org.aopalliance.intercept.MethodInterceptor</td>
</tr>
<tr class="even">
<td>异常抛出通知</td>
<td>方法抛出异常</td>
<td>org.springframework.aop.ThrowsAdvice</td>
</tr>
<tr class="odd">
<td>引介通知</td>
<td>类中增加新的方法属性</td>
<td>org.springframework.aop.IntroductionInterceptor</td>
</tr>
</tbody>
</table>
<p>即AOP在不改变原有代码的清空下，去增加新的功能。</p>
<h2 id="使用spring实现aop">使用Spring实现AOP</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.aspectj/aspectjweaver --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">   &lt;groupId&gt;org.aspectj&lt;/groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;</span><br><span class="line">   &lt;version&gt;1.9.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2022</span>
<!--  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
-->
 by 
  <span class="author" itemprop="copyrightHolder">Yus</span>
</div>

<!-- -->

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
